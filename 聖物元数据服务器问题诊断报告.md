# è–ç‰©å…ƒæ•°æ®æœåŠ¡å™¨é—®é¢˜è¯Šæ–­æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

æ‚¨çš„è–ç‰©å…ƒæ•°æ®è¯·æ±‚æ— æ³•æ­£å¸¸å“åº”çš„åŸå› å·²ç»ç¡®å®šã€‚å…ƒæ•°æ®æœåŠ¡å™¨å®é™…ä¸Š**å·²ç»åœ¨è¿è¡Œ**ï¼Œä½†æ˜¯ç”±äºé…ç½®é—®é¢˜å¯¼è‡´æ— æ³•æ­£å¸¸å·¥ä½œã€‚

## ğŸ” å½“å‰çŠ¶æ€

- **æœåŠ¡å™¨çŠ¶æ€**: âœ… è¿è¡Œä¸­ (ç«¯å£ 3001)
- **å¥åº·æ£€æŸ¥**: âš ï¸ é™çº§çŠ¶æ€ (degraded)
- **è–ç‰©API**: âŒ å¤±è´¥ (404 Not Found)

## ğŸš¨ å‘ç°çš„é—®é¢˜

### 1. Redisç¼“å­˜æœåŠ¡æœªè¿è¡Œ
```
Error: connect ECONNREFUSED 127.0.0.1:6379
```
- RedisæœåŠ¡æœªå¯åŠ¨ï¼Œå¯¼è‡´ç¼“å­˜åŠŸèƒ½ä¸å¯ç”¨
- æœåŠ¡å™¨çŠ¶æ€æ˜¾ç¤ºä¸º"degraded"

### 2. GraphQLæŸ¥è¯¢å¤±è´¥
```
Cannot destructure property 'relics' of '(intermediate value)' as it is undefined
```
- The Graph APIè¿”å›çš„æ•°æ®ç»“æ„ä¸æ­£ç¡®
- å¯èƒ½æ˜¯APIç«¯ç‚¹é…ç½®é”™è¯¯

### 3. åˆçº¦åœ°å€é…ç½®é—®é¢˜
```
Key: "0x0000000000000000000000000000000000000000-1"
```
- ä½¿ç”¨äº†å ä½ç¬¦åœ°å€è€ŒéçœŸå®åˆçº¦åœ°å€
- å¯¼è‡´æ— æ³•ä»åŒºå—é“¾è·å–çœŸå®æ•°æ®

### 4. The Graph APIé…ç½®é”™è¯¯
```
VITE_THE_GRAPH_STUDIO_API_URL=https://api.studio.thegraph.com/query/your-subgraph-id/dungeon-delvers/version/latest
```
- ä½¿ç”¨äº†å ä½ç¬¦URLè€ŒéçœŸå®çš„GraphQLç«¯ç‚¹

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ç«‹å³è§£å†³æ–¹æ¡ˆ

1. **å®‰è£…å¹¶å¯åŠ¨Redis**
```bash
# å®‰è£…Redis
sudo apt update && sudo apt install redis-server -y

# å¯åŠ¨Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

2. **æ›´æ–°ç¯å¢ƒå˜é‡é…ç½®**
éœ€è¦åœ¨`.env`æ–‡ä»¶ä¸­é…ç½®çœŸå®çš„ï¼š
- åˆçº¦åœ°å€
- The Graph APIç«¯ç‚¹
- RPCç«¯ç‚¹

### å®Œæ•´ä¿®å¤æ­¥éª¤

#### æ­¥éª¤1: å¯åŠ¨RedisæœåŠ¡
```bash
cd /workspace/dungeon-delvers-metadata-server
sudo apt update && sudo apt install redis-server -y
sudo systemctl start redis-server
```

#### æ­¥éª¤2: æ›´æ–°ç¯å¢ƒå˜é‡
éœ€è¦è·å–çœŸå®çš„åˆçº¦åœ°å€å’ŒAPIç«¯ç‚¹ï¼š
```bash
# ç¼–è¾‘.envæ–‡ä»¶
nano .env

# éœ€è¦æ›´æ–°çš„å…³é”®é…ç½®ï¼š
VITE_THE_GRAPH_STUDIO_API_URL=https://api.studio.thegraph.com/query/[çœŸå®çš„subgraph-id]/dungeon-delvers/version/latest
VITE_MAINNET_RELIC_ADDRESS=0x[çœŸå®çš„Relicåˆçº¦åœ°å€]
VITE_MAINNET_HERO_ADDRESS=0x[çœŸå®çš„Heroåˆçº¦åœ°å€]
# ... å…¶ä»–åˆçº¦åœ°å€
```

#### æ­¥éª¤3: é‡å¯æœåŠ¡å™¨
```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨
pkill -f "node src/index.js"

# é‡æ–°å¯åŠ¨
npm start
```

#### æ­¥éª¤4: éªŒè¯ä¿®å¤
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# æµ‹è¯•è–ç‰©API
curl http://localhost:3001/api/relic/1
```

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœæš‚æ—¶æ— æ³•è·å–çœŸå®çš„åˆçº¦åœ°å€ï¼Œå¯ä»¥ï¼š

1. **ä½¿ç”¨Dockerå¯åŠ¨Redis**
```bash
docker run -d --name redis -p 6379:6379 redis:alpine
```

2. **ä¿®æ”¹æœåŠ¡å™¨é…ç½®ä»¥è·³è¿‡Redis**
åœ¨ä»£ç ä¸­æ·»åŠ fallbacké€»è¾‘ï¼Œå½“Redisä¸å¯ç”¨æ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚

## ğŸ“Š å½“å‰æœåŠ¡å™¨æŒ‡æ ‡

- **è¿è¡Œæ—¶é—´**: 9.7ç§’
- **å†…å­˜ä½¿ç”¨**: 87MB
- **ç¼“å­˜å‘½ä¸­ç‡**: 0% (ç”±äºRedisä¸å¯ç”¨)
- **è¯·æ±‚å¤„ç†**: 2ä¸ªè¯·æ±‚å·²å¤„ç†

## ğŸ¯ å»ºè®®çš„åç»­è¡ŒåŠ¨

1. **ç«‹å³**: å¯åŠ¨RedisæœåŠ¡
2. **çŸ­æœŸ**: è·å–å¹¶é…ç½®çœŸå®çš„åˆçº¦åœ°å€å’ŒAPIç«¯ç‚¹
3. **é•¿æœŸ**: è®¾ç½®ç›‘æ§å’Œè­¦æŠ¥ç³»ç»Ÿ

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æœåŠ¡å™¨æ¶æ„
- **Express.js** æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£3001
- **Redis** ç”¨äºåˆ†å¸ƒå¼ç¼“å­˜ (ç›®å‰æœªè¿è¡Œ)
- **The Graph** ç”¨äºåŒºå—é“¾æ•°æ®æŸ¥è¯¢
- **DataLoader** ç”¨äºæ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–

### é”™è¯¯æ—¥å¿—åˆ†æ
```json
{
  "error": "Relic #1 not found in The Graph",
  "message": "Resource not found.",
  "timestamp": "2025-07-10T14:25:48.821Z"
}
```

è¿™è¡¨æ˜æœåŠ¡å™¨å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä½†æ— æ³•ä»The Graphè·å–æ•°æ®ã€‚

## ğŸš€ ç»“è®º

æ‚¨çš„è–ç‰©å…ƒæ•°æ®æœåŠ¡å™¨**å·²ç»åœ¨è¿è¡Œ**ï¼Œé—®é¢˜åœ¨äºé…ç½®è€ŒéæœåŠ¡å™¨æœ¬èº«ã€‚ä¸€æ—¦è§£å†³äº†Redisã€åˆçº¦åœ°å€å’ŒThe Graph APIé…ç½®é—®é¢˜ï¼ŒæœåŠ¡å™¨å°±èƒ½æ­£å¸¸å“åº”è–ç‰©ç›¸å…³çš„å…ƒæ•°æ®è¯·æ±‚ã€‚

ä¼˜å…ˆçº§ï¼š
1. **é«˜**: å¯åŠ¨RedisæœåŠ¡
2. **é«˜**: é…ç½®çœŸå®çš„The Graph APIç«¯ç‚¹
3. **ä¸­**: é…ç½®çœŸå®çš„åˆçº¦åœ°å€
4. **ä½**: ä¼˜åŒ–æ€§èƒ½å’Œç›‘æ§

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-07-10 14:25*