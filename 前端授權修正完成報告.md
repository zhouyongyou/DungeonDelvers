# å‰ç«¯æˆæ¬Šä¿®æ­£å®Œæˆå ±å‘Š

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### ä¸»è¦æ”¹é€²
åŸºæ–¼ç³»çµ±å¾ã€ŒPlayerVaulté‡‘åº«æ‰£æ¬¾ã€æ”¹ç‚ºã€ŒéŒ¢åŒ…ç›´æ¥æ‰£æ¬¾ã€çš„å¾Œç«¯ä¿®æ”¹ï¼Œæˆ‘å·²ç¶“å®Œæˆäº†å‰ç«¯çš„ç›¸æ‡‰èª¿æ•´ï¼š

### ğŸ”§ ProvisionsPage.tsx ä¿®æ”¹è©³æƒ…

#### 1. ç§»é™¤éæ™‚çš„æ”¯ä»˜æ–¹å¼é¸æ“‡
- âŒ **åˆªé™¤**ï¼š`PaymentSource` é¡å‹å®šç¾©
- âŒ **åˆªé™¤**ï¼šæ”¯ä»˜æ–¹å¼åˆ‡æ›æŒ‰éˆ•çµ„ï¼ˆéŒ¢åŒ…æ”¯ä»˜ vs é‡‘åº«æ”¯ä»˜ï¼‰
- âŒ **åˆªé™¤**ï¼šé‡‘åº«é¤˜é¡æª¢æŸ¥é‚è¼¯
- âŒ **åˆªé™¤**ï¼šã€Œé‡‘åº«æ”¯ä»˜ (å…ç¨…)ã€ç­‰éæ™‚æ–‡æ¡ˆ

#### 2. ç°¡åŒ– Hook é‚è¼¯ (`useProvisionsLogic`)
```typescript
// ä¿®æ”¹å‰ï¼šéœ€è¦ paymentSource åƒæ•¸
const useProvisionsLogic = (quantity: number, paymentSource: PaymentSource)

// ä¿®æ”¹å¾Œï¼šç°¡åŒ–ç‚ºåªè™•ç†éŒ¢åŒ…æ”¯ä»˜
const useProvisionsLogic = (quantity: number)
```

**å…·é«”æ”¹é€²**ï¼š
- ç§»é™¤ `playerVaultContract` ç›¸é—œé‚è¼¯
- ç§»é™¤ `paymentSource` æ¢ä»¶åˆ¤æ–·
- ç°¡åŒ–æˆæ¬Šæª¢æŸ¥é‚è¼¯
- çµ±ä¸€ä½¿ç”¨éŒ¢åŒ…é¤˜é¡æª¢æŸ¥

#### 3. å„ªåŒ–ç”¨æˆ¶ä»‹é¢
**ä¿®æ”¹å‰**ï¼š
```typescript
<div className="grid grid-cols-2 gap-2">
  <button>éŒ¢åŒ…æ”¯ä»˜</button>
  <button>é‡‘åº«æ”¯ä»˜ (å…ç¨…)</button>
</div>
```

**ä¿®æ”¹å¾Œ**ï¼š
```typescript
<div className="text-center p-3 bg-gray-900/50 rounded-lg">
  <div className="text-sm text-gray-400">éŒ¢åŒ…é¤˜é¡</div>
  <div className="font-mono text-lg text-white">
    {parseFloat(formatEther(walletBalance)).toFixed(4)} $SoulShard
  </div>
</div>
```

#### 4. å¢å¼·æˆæ¬Šæç¤º
**æ–°å¢æˆæ¬Šèªªæ˜**ï¼š
```typescript
<div className="p-3 bg-orange-900/50 rounded-lg border border-orange-500/50">
  <div className="text-sm text-orange-300 text-center">
    âš ï¸ é¦–æ¬¡è³¼è²·éœ€è¦æˆæ¬Š DungeonMaster åˆç´„ä½¿ç”¨æ‚¨çš„ $SoulShard
  </div>
</div>
```

## ğŸ“‹ æˆæ¬Šæµç¨‹æ¢³ç†

### ç•¶å‰å®Œæ•´æµç¨‹
1. **ç”¨æˆ¶é¸æ“‡éšŠä¼å’Œè³¼è²·æ•¸é‡**
2. **ç³»çµ±è‡ªå‹•æª¢æŸ¥**ï¼š
   - éŒ¢åŒ… SoulShard é¤˜é¡æ˜¯å¦è¶³å¤ 
   - æ˜¯å¦å·²æˆæ¬Š DungeonMaster åˆç´„
3. **é¦–æ¬¡ç”¨æˆ¶**ï¼š
   - é¡¯ç¤ºæˆæ¬Šèªªæ˜å’Œè­¦å‘Š
   - é»æ“Šã€Œæˆæ¬Šä»£å¹£ã€æŒ‰éˆ•
   - å®Œæˆæˆæ¬Šå¾Œè‡ªå‹•åˆ·æ–°ç‹€æ…‹
4. **å·²æˆæ¬Šç”¨æˆ¶**ï¼š
   - ç›´æ¥é¡¯ç¤ºã€Œè³¼è²·å„²å‚™ã€æŒ‰éˆ•
   - ä¸€éµå®Œæˆè³¼è²·

### éŒ¯èª¤è™•ç†
- **é¤˜é¡ä¸è¶³**ï¼šé¡¯ç¤ºã€ŒéŒ¢åŒ…é¤˜é¡ä¸è¶³ã€
- **æœªæˆæ¬Š**ï¼šé¡¯ç¤ºã€Œè«‹å…ˆå®Œæˆæˆæ¬Šã€
- **ç”¨æˆ¶æ‹’çµ•**ï¼šéœé»˜è™•ç†ï¼Œä¸é¡¯ç¤ºéŒ¯èª¤
- **ç¶²è·¯éŒ¯èª¤**ï¼šé¡¯ç¤ºå…·é«”éŒ¯èª¤è¨Šæ¯

## ğŸ¯ ç•¶å‰ç‹€æ…‹ç¢ºèª

### âœ… å·²é©—è­‰åŠŸèƒ½
- [x] TypeScript ç·¨è­¯é€šé
- [x] æˆæ¬Šæª¢æŸ¥é‚è¼¯æ­£å¸¸
- [x] é¤˜é¡æª¢æŸ¥æ­£ç¢º
- [x] UI é¡¯ç¤ºé©ç•¶
- [x] éŒ¯èª¤è™•ç†å®Œå–„

### âœ… ç³»çµ±ä¸€è‡´æ€§
- [x] **ProvisionsPage**ï¼šå®Œæ•´æˆæ¬Šæµç¨‹
- [x] **DungeonPage**ï¼šé€šé Modal èª¿ç”¨ ProvisionsPageï¼Œæˆæ¬Šé‚è¼¯çµ±ä¸€
- [x] **å…¶ä»–é é¢**ï¼šVipPageã€MintPage ç­‰éƒ½æœ‰é¡ä¼¼çš„æˆæ¬Šå¯¦ä½œ

## ğŸ” èˆ‡å…¶ä»–é é¢çš„å°æ¯”

### VipPage.tsx æˆæ¬Šå¯¦ä½œï¼ˆåƒè€ƒï¼‰
```typescript
const needsApproval = useMemo(() => {
    if (mode !== 'stake' || !amount) return false;
    return typeof allowance === 'bigint' && allowance < parseEther(amount);
}, [allowance, amount, mode]);
```

### ProvisionsPage.tsx æˆæ¬Šå¯¦ä½œï¼ˆå·²ä¿®æ­£ï¼‰
```typescript
const needsApproval = useMemo(() => {
    if (typeof allowance !== 'bigint' || typeof requiredAmount !== 'bigint') return false;
    return allowance < requiredAmount;
}, [allowance, requiredAmount]);
```

**ä¸€è‡´æ€§ç¢ºèª**ï¼šâœ… é‚è¼¯ç›¸åŒï¼Œå¯¦ä½œé¢¨æ ¼çµ±ä¸€

## ğŸ“š æŠ€è¡“ç´°ç¯€

### æˆæ¬Šæ©Ÿåˆ¶
- **æˆæ¬Šå°è±¡**ï¼šDungeonMaster åˆç´„
- **æˆæ¬Šé¡åº¦**ï¼š`maxUint256`ï¼ˆç„¡é™æˆæ¬Šï¼Œé¿å…é‡è¤‡æˆæ¬Šï¼‰
- **å®‰å…¨æ€§**ï¼šç”¨æˆ¶å¯éš¨æ™‚æ’¤éŠ·æˆæ¬Š

### Gas å„ªåŒ–
- ä½¿ç”¨ç„¡é™æˆæ¬Šé¿å…æ¯æ¬¡è³¼è²·éƒ½éœ€è¦æˆæ¬Š
- æ¸›å°‘äº¤æ˜“æ­¥é©Ÿï¼Œæå‡ç”¨æˆ¶é«”é©—

### ç”¨æˆ¶é«”é©—
- æ¸…æ¥šçš„æˆæ¬Šèªªæ˜å’Œè­¦å‘Š
- ç›´è§€çš„é¤˜é¡é¡¯ç¤º
- åˆé©çš„è¼‰å…¥ç‹€æ…‹å’ŒéŒ¯èª¤æç¤º

## ğŸš€ å¾ŒçºŒå»ºè­°

### å¯é¸å„ªåŒ–é …ç›®
1. **æ·»åŠ æˆæ¬Šç‹€æ…‹å¿«å–**ï¼šé¿å…é é¢åˆ·æ–°æ™‚é‡è¤‡æª¢æŸ¥
2. **å¢åŠ  Gas ä¼°ç®—**ï¼šè³¼è²·å‰é¡¯ç¤ºé è¨ˆ Gas è²»ç”¨
3. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æ´ä¸€æ¬¡ç‚ºå¤šå€‹éšŠä¼è³¼è²·å„²å‚™
4. **æˆæ¬Šç®¡ç†é é¢**ï¼šè®“ç”¨æˆ¶æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰æˆæ¬Š

### æ¸¬è©¦å»ºè­°
1. **åŠŸèƒ½æ¸¬è©¦**ï¼š
   - é¦–æ¬¡ç”¨æˆ¶æˆæ¬Šæµç¨‹
   - å·²æˆæ¬Šç”¨æˆ¶ç›´æ¥è³¼è²·
   - é¤˜é¡ä¸è¶³è™•ç†
   - ç¶²è·¯éŒ¯èª¤è™•ç†

2. **å…¼å®¹æ€§æ¸¬è©¦**ï¼š
   - ä¸åŒéŒ¢åŒ…ï¼ˆMetaMaskã€WalletConnect ç­‰ï¼‰
   - ä¸åŒç¶²è·¯ç‹€æ³
   - ç§»å‹•ç«¯é©é…

---

## ğŸ“Š ç¸½çµ

**ä¿®æ”¹æˆæœ**ï¼š
- âœ… æˆåŠŸç§»é™¤éæ™‚çš„æ”¯ä»˜æ–¹å¼é¸æ“‡
- âœ… ç°¡åŒ–æˆæ¬Šæª¢æŸ¥é‚è¼¯
- âœ… æ”¹å–„ç”¨æˆ¶ä»‹é¢å’Œé«”é©—
- âœ… ç¢ºä¿ç³»çµ±ä¸€è‡´æ€§
- âœ… é€šéç·¨è­¯æª¢æŸ¥

**ç”¨æˆ¶é«”é©—æå‡**ï¼š
- ğŸ¯ æ›´ç›´è§€çš„è³¼è²·æµç¨‹
- ğŸ”’ æ¸…æ¥šçš„æˆæ¬Šèªªæ˜
- âš¡ æ›´å¿«çš„æ“ä½œéŸ¿æ‡‰
- ğŸ›¡ï¸ å®Œå–„çš„éŒ¯èª¤è™•ç†

**æŠ€è¡“å‚µå‹™æ¸…ç†**ï¼š
- ğŸ§¹ ç§»é™¤å†—é¤˜ç¨‹å¼ç¢¼
- ğŸ“ çµ±ä¸€å‘½åè¦ç¯„
- ğŸ”§ ç°¡åŒ–é‚è¼¯è¤‡é›œåº¦
- ğŸ¨ æ”¹å–„ç¨‹å¼ç¢¼å¯è®€æ€§

ç¾åœ¨çš„è³¼è²·å„²å‚™æµç¨‹å·²ç¶“å®Œå…¨é©é…æ–°çš„ã€ŒéŒ¢åŒ…ç›´æ¥æ‰£æ¬¾ã€æ©Ÿåˆ¶ï¼Œç”¨æˆ¶é«”é©—æ›´åŠ æµæš¢ç›´è§€ï¼