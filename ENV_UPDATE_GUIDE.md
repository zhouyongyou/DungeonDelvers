# ENV 檔案更新指南

## 問題分析

你的 ENV 檔案中的合約地址與前端配置中的地址不一致，需要更新以確保系統正常運作。

## 需要修改的配置

### 1. 合約地址更新

#### 當前 ENV 檔案中的地址：
```bash
VITE_MAINNET_ORACLE_ADDRESS=0x4293aa4a23f0B6EB48bB3B5442bAE17d8e6a0EAB
VITE_MAINNET_DUNGEONSTORAGE_ADDRESS=0xD9442c56B76bF86a4ABA414687DD13b08982c495
VITE_MAINNET_PLAYERVAULT_ADDRESS=0x22ec24B183afd81c69d14ebB9f226D3e0BC75C03
VITE_MAINNET_ALTAROFASCENSION_ADDRESS=0xd9bE09b96959BEA3e335850b540EC51b841Df9Cc
VITE_MAINNET_DUNGEONMASTER_ADDRESS=0xe208554A49aDeE49FA774a736C5279A5CB930FB8
VITE_MAINNET_PLAYERPROFILE_ADDRESS=0xE51ae47bf0f9958a0b35f1830675d88C2c7F5232
VITE_MAINNET_DUNGEONCORE_ADDRESS=0x05398E72d53Ced9746E8525BcF35514d7ddbBCd8
VITE_MAINNET_HERO_ADDRESS=0x347752f8166D270EDE722C3F31A10584bC2867b3
VITE_MAINNET_RELIC_ADDRESS=0x06994Fb1eC1Ba0238d8CA9539dAbdbEF090A5b53
VITE_MAINNET_PARTY_ADDRESS=0x4F4796b04e3BD3E8d5B447e32944d8B04eF53EB2
VITE_MAINNET_VIPSTAKING_ADDRESS=0x8A9943Bb231eC9131d750c7bcf8A4Ae36bd4f0F8
```

#### 前端配置中的地址：
```typescript
// src/config/contracts.ts
CORE: {
  DUNGEON_CORE: "0xbCc8C53A0F52ad1685F4356768d88FA6ac218d66",
  ORACLE: "0x86C17E2f8940FFE6c64bf9B513656b4c51f1Ffc6", 
  PLAYER_VAULT: "0x8727c5aEd22A2cf39d183D00cC038eE600F24726"
},
NFTS: {
  HERO: "0x2Cf5429dDbd2Df730a6668b50200233c76c1116F",
  RELIC: "0x548eA33d0deC74bBE9a3F0D1B5E4C660bf59E5A5",
  PARTY: "0x78dBA7671753191FFeeBEEed702Aab4F2816d70D"
},
GAME: {
  DUNGEON_MASTER: "0xb9beF542bd333B5301846629C87363DE4FB520b7",
  ALTAR: "0x643cB4A9EF6AE813ACeeB2a1E193b6894bdf8708",
  PLAYER_PROFILE: "0x98708fFC8afaC1289639C797f5A6F095217FAFB8"
},
TOKENS: {
  SOUL_SHARD: "0xc88dAD283Ac209D77Bfe452807d378615AB8B94a",
  VIP_STAKING: "0xf1F84F3F3632fbB9be2F3d132C3660100d2C98e2"
}
```

### 2. 建議的 ENV 檔案更新

```bash
# =================================================================
# Section: 核心功能合約地址 (最終版本)
# =================================================================
VITE_MAINNET_ORACLE_ADDRESS=0x86C17E2f8940FFE6c64bf9B513656b4c51f1Ffc6
VITE_MAINNET_DUNGEONSTORAGE_ADDRESS=0x3859536f603e885525C28c0F875dAAB743C3EA1A
VITE_MAINNET_PLAYERVAULT_ADDRESS=0x8727c5aEd22A2cf39d183D00cC038eE600F24726
VITE_MAINNET_ALTAROFASCENSION_ADDRESS=0x643cB4A9EF6AE813ACeeB2a1E193b6894bdf8708
VITE_MAINNET_DUNGEONMASTER_ADDRESS=0xb9beF542bd333B5301846629C87363DE4FB520b7
VITE_MAINNET_PLAYERPROFILE_ADDRESS=0x98708fFC8afaC1289639C797f5A6F095217FAFB8
VITE_MAINNET_DUNGEONCORE_ADDRESS=0xbCc8C53A0F52ad1685F4356768d88FA6ac218d66

# =================================================================
# Section: NFT 合約地址 (更新為前端配置中的地址)
# =================================================================
VITE_MAINNET_HERO_ADDRESS=0x2Cf5429dDbd2Df730a6668b50200233c76c1116F
VITE_MAINNET_RELIC_ADDRESS=0x548eA33d0deC74bBE9a3F0D1B5E4C660bf59E5A5
VITE_MAINNET_PARTY_ADDRESS=0x78dBA7671753191FFeeBEEed702Aab4F2816d70D
VITE_MAINNET_VIPSTAKING_ADDRESS=0xf1F84F3F3632fbB9be2F3d132C3660100d2C98e2
```

### 3. 移除不需要的配置

由於我們已經簡化了配置，以下配置可以移除或保持不變：

```bash
# 這些可以保持不變
VITE_MAINNET_URL="https://dungeondelvers.xyz"
VITE_ALCHEMY_BSC_MAINNET_RPC_URL="https://bnb-mainnet.g.alchemy.com/v2/3lmTWjUVbFylAurhdU-rSUefTC-P4tKf"
VITE_THE_GRAPH_STUDIO_API_URL="https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest"

# 這些可以移除（因為簡化後不再使用）
# VITE_METADATA_SERVER_BASE_URL="https://dungeon-delvers-metadata-server.onrender.com"
# VITE_ANKR_BSC_MAINNET_RPC_URL="..."
# VITE_INFURA_BSC_MAINNET_RPC_URL="..."
# VITE_BSC_MAINNET_RPC_URL="..."
```

## 更新步驟

### 1. 備份當前 ENV 檔案
```bash
cp .env .env.backup
```

### 2. 更新合約地址
將上述建議的地址更新到你的 `.env` 檔案中。

### 3. 驗證配置
```bash
# 檢查前端是否能正確讀取合約地址
npm run dev
```

### 4. 測試合約連接
在瀏覽器控制台中檢查是否有合約連接錯誤。

## 注意事項

1. **合約地址一致性**：確保前端配置和 ENV 檔案中的地址完全一致
2. **備份重要**：更新前務必備份原始 ENV 檔案
3. **測試驗證**：更新後要測試所有功能是否正常運作
4. **Metadata Server**：雖然我們簡化了前端，但 Metadata Server 仍然需要這些地址來生成正確的 metadata

## 問題排查

如果更新後出現問題：

1. 檢查瀏覽器控制台是否有合約地址相關錯誤
2. 確認所有地址都是正確的 BSC 主網地址
3. 檢查 RPC 端點是否正常運作
4. 確認 GraphQL 端點是否可訪問 