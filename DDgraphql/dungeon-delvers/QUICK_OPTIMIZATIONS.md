# å­åœ–å¿«é€Ÿå„ªåŒ–æŒ‡å—

## ğŸš€ ç«‹å³å¯å¯¦æ–½çš„å„ªåŒ–ï¼ˆä¸éœ€è¦é‡å¯«ï¼‰

### 1. æ¸›å°‘æ—¥èªŒè¼¸å‡º âš¡
**è¤‡é›œåº¦**ï¼šç°¡å–®  
**æ™‚é–“**ï¼š10åˆ†é˜  
**æ•ˆæœ**ï¼š5-10% æ•ˆèƒ½æå‡

```typescript
// æª”æ¡ˆï¼šæ‰€æœ‰ .ts è™•ç†å™¨
// æœå°‹ä¸¦ç§»é™¤æˆ–è¨»è§£ï¼š
log.info(...);  // ç§»é™¤
log.warning(...);  // ä¿ç•™ï¼ˆé‡è¦è­¦å‘Šï¼‰
log.error(...);  // ä¿ç•™ï¼ˆéŒ¯èª¤å¿…é ˆè¨˜éŒ„ï¼‰
```

### 2. å„ªåŒ–çµ±è¨ˆæ›´æ–°é »ç‡ ğŸ“Š
**è¤‡é›œåº¦**ï¼šä¸­ç­‰  
**æ™‚é–“**ï¼š30åˆ†é˜  
**æ•ˆæœ**ï¼š15-20% æ•ˆèƒ½æå‡

```typescript
// åŸæœ¬ï¼šæ¯å€‹äº‹ä»¶éƒ½æ›´æ–°çµ±è¨ˆ
export function handleHeroMinted(event: HeroMinted): void {
  // ... è™•ç†è‹±é›„
  updateGlobalStats(TOTAL_HEROES, 1, event.block.timestamp);  // æ¯æ¬¡éƒ½å¯«å…¥
}

// å„ªåŒ–ï¼šæ‰¹æ¬¡æ›´æ–°ï¼ˆæ¯ 10 å€‹å€å¡Šï¼‰
export function handleHeroMinted(event: HeroMinted): void {
  // ... è™•ç†è‹±é›„
  if (event.block.number.mod(BigInt.fromI32(10)).equals(BigInt.zero())) {
    updateGlobalStats(TOTAL_HEROES, getPendingHeroCount(), event.block.timestamp);
  }
}
```

### 3. ç§»é™¤ä¸å¿…è¦çš„ entity é—œè¯ ğŸ”—
**è¤‡é›œåº¦**ï¼šç°¡å–®  
**æ™‚é–“**ï¼š20åˆ†é˜  
**æ•ˆæœ**ï¼š10-15% æŸ¥è©¢æ•ˆèƒ½æå‡

```graphql
# schema.graphql
# ç§»é™¤ä¸å¸¸ç”¨çš„ @derivedFrom é—œè¯
type Hero @entity {
  id: ID!
  owner: Bytes!
  # parties: [Party!]! @derivedFrom(field: "heroes")  # ç§»é™¤
  # åªä¿ç•™å¿…è¦æ¬„ä½
}
```

### 4. ç°¡åŒ–è¤‡é›œè¨ˆç®— ğŸ§®
**è¤‡é›œåº¦**ï¼šä¸­ç­‰  
**æ™‚é–“**ï¼š30åˆ†é˜  
**æ•ˆæœ**ï¼š5-10% æ•ˆèƒ½æå‡

```typescript
// åŸæœ¬ï¼šæ¯æ¬¡éƒ½é‡æ–°è¨ˆç®—ç¸½åŠ›é‡
party.totalPower = calculateTotalPower(heroes, relics);

// å„ªåŒ–ï¼šå¢é‡æ›´æ–°
party.totalPower = party.totalPower + newHeroPower - oldHeroPower;
```

### 5. åˆä½µé‡è¤‡çš„è³‡æ–™åº«æŸ¥è©¢ ğŸ”„
**è¤‡é›œåº¦**ï¼šç°¡å–®  
**æ™‚é–“**ï¼š15åˆ†é˜  
**æ•ˆæœ**ï¼š10% æ•ˆèƒ½æå‡

```typescript
// åŸæœ¬ï¼šå¤šæ¬¡æŸ¥è©¢
let hero1 = Hero.load(id1);
let hero2 = Hero.load(id2);
let hero3 = Hero.load(id3);

// å„ªåŒ–ï¼šæ‰¹æ¬¡è¼‰å…¥ï¼ˆå¦‚æœ AssemblyScript æ”¯æ´ï¼‰
// æˆ–å¿«å–å¸¸ç”¨å¯¦é«”
```

## ğŸ“‹ å¯¦æ–½æ­¥é©Ÿ

1. **å‚™ä»½ç•¶å‰ç‰ˆæœ¬**
   ```bash
   cp -r src src-backup
   ```

2. **é€æ­¥å¯¦æ–½å„ªåŒ–**
   - å…ˆåšç°¡å–®çš„ï¼ˆç§»é™¤æ—¥èªŒï¼‰
   - æ¸¬è©¦æ¯å€‹å„ªåŒ–çš„æ•ˆæœ
   - ç›£æ§åŒæ­¥é€Ÿåº¦è®ŠåŒ–

3. **é©—è­‰è³‡æ–™ä¸€è‡´æ€§**
   - ç¢ºä¿å„ªåŒ–å¾Œè³‡æ–™æ­£ç¢º
   - æ¯”å°é—œéµçµ±è¨ˆæ•¸æ“š

## ğŸ¯ é æœŸç¸½é«”æ•ˆæœ

| å„ªåŒ–é …ç›® | å–®é …æå‡ | ç´¯ç©æå‡ |
|---------|---------|---------|
| ç§»é™¤æ—¥èªŒ | 5-10% | 5-10% |
| æ‰¹æ¬¡çµ±è¨ˆ | 15-20% | 20-30% |
| ç°¡åŒ–é—œè¯ | 10-15% | 30-45% |
| ç°¡åŒ–è¨ˆç®— | 5-10% | 35-55% |
| åˆä½µæŸ¥è©¢ | 10% | 45-65% |

**ç¸½é«”é æœŸ**ï¼šåŒæ­¥æ™‚é–“å¾ 3-5åˆ†é˜ â†’ 1.5-2.5åˆ†é˜

## âš ï¸ æ³¨æ„äº‹é …

1. **ä¸è¦éåº¦å„ªåŒ–**
   - ä¿æŒç¨‹å¼ç¢¼å¯è®€æ€§
   - å„ªåŒ–è¦æœ‰æ¸¬é‡ä¾æ“š

2. **åˆ†éšæ®µå¯¦æ–½**
   - æ¯æ¬¡åªåšä¸€ç¨®å„ªåŒ–
   - å……åˆ†æ¸¬è©¦å¾Œå†åšä¸‹ä¸€å€‹

3. **ä¿ç•™å›æ»¾èƒ½åŠ›**
   - å‚™ä»½åŸå§‹ç¨‹å¼ç¢¼
   - è¨˜éŒ„æ¯æ¬¡å„ªåŒ–çš„è®Šæ›´

## ğŸ”§ å‰ç«¯é…åˆèª¿æ•´

### éœ€è¦èª¿æ•´çš„ Hooksï¼š
```typescript
// useMarketStats - æ·»åŠ éŒ¯èª¤è™•ç†
export const useMarketStats = () => {
  return useQuery({
    queryKey: ['marketStats'],
    queryFn: async () => {
      try {
        return await marketplaceApi.getMarketStats();
      } catch (error) {
        // å¸‚å ´åŠŸèƒ½æš«æ™‚é—œé–‰ï¼Œè¿”å›ç©ºè³‡æ–™
        return { listings: 0, volume: 0, users: 0 };
      }
    },
    retry: false,  // ä¸é‡è©¦
  });
};
```

### GraphQL æŸ¥è©¢èª¿æ•´ï¼š
```typescript
// ç§»é™¤å¸‚å ´ç›¸é—œæ¬„ä½
const GET_PLAYER_ASSETS = gql`
  query GetPlayerAssets($owner: String!) {
    player(id: $owner) {
      heroes { ... }
      relics { ... }
      parties { ... }
      # marketListings { ... }  // ç§»é™¤
      # offers { ... }  // ç§»é™¤
    }
  }
`;
```

---

æœ€å¾Œæ›´æ–°ï¼š2025-08-02  
ä¸‹æ¬¡å„ªåŒ–è©•ä¼°ï¼šéƒ¨ç½²å¾Œè§€å¯Ÿæ•ˆæœ