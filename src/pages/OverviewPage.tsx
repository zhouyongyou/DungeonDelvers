// src/pages/OverviewPage.tsx

import React, { useState, useMemo } from 'react';
import { useAccount } from 'wagmi';
import { useQuery } from '@tanstack/react-query';
import { useCachedReadContract } from '../hooks/useCachedReadContract';
import { formatEther } from 'viem';
import { formatSoul, formatLargeNumber } from '../utils/formatters';
import { getContractWithABI } from '../config/contractsWithABI';
import { ActionButton } from '../components/ui/ActionButton';
import type { Page } from '../types/page';
import { useAppToast } from '../contexts/SimpleToastContext';
import { useTransactionWithProgress } from '../hooks/useTransactionWithProgress';
import { TransactionProgressModal } from '../components/ui/TransactionProgressModal';
import { Icons } from '../components/ui/icons';
import { bsc } from 'wagmi/chains';
import { TownBulletin } from '../components/ui/TownBulletin';
import { ExpeditionTracker } from '../components/ExpeditionTracker';
import { LocalErrorBoundary, LoadingState, ErrorState } from '../components/ui/ErrorBoundary';
import { LoadingSpinner } from '../components/ui/LoadingSpinner';
import { EmptyState } from '../components/ui/EmptyState';
import { generateProfileSVG, type ProfileData } from '../utils/svgGenerators';
import { logger } from '../utils/logger';
import { usePlayerOverview } from '../hooks/usePlayerOverview';
import { useVipStatus } from '../hooks/useVipStatus';
import { WithdrawalHistoryButton } from '../components/ui/WithdrawalHistory';
import { useTransactionHistory, createTransactionRecord } from '../stores/useTransactionPersistence';
import { TaxRateModal } from '../components/ui/TaxRateModal';
import { useUnassignedAssets } from '../hooks/useUnassignedAssets';
import { useSoulPrice } from '../hooks/useSoulPrice';

// =================================================================
// Section: Components
// =================================================================

const StatCard: React.FC<{
    title: string;
    value: string;
    icon: React.ReactNode;
    description?: string;
    action?: React.ReactNode;
}> = ({ title, value, icon, description, action }) => (
    <div className="bg-gray-800 p-6 rounded-lg">
        <div className="flex items-center justify-between mb-2">
            <div className="text-gray-400 flex items-center gap-2">
                {icon}
                <span className="text-sm">{title}</span>
            </div>
            {action}
        </div>
        <p className="text-2xl font-bold text-white">{value}</p>
        {description && <p className="text-xs text-gray-500 mt-1">{description}</p>}
    </div>
);

// =================================================================
// Section: Main Component
// =================================================================

interface OverviewPageProps {
    setActivePage: (page: Page) => void;
}

const OverviewPage: React.FC<OverviewPageProps> = ({ setActivePage }) => {
    const { address, isConnected } = useAccount();
    const [showProfileSVG, setShowProfileSVG] = useState(false);
    const [showTaxModal, setShowTaxModal] = useState(false);
    const { showToast } = useAppToast();
    const { data, isLoading, isError, refetch } = usePlayerOverview(address);
    const { addTransaction, updateTransaction } = useTransactionHistory(address);
    
    // ‰ΩøÁî®ÂêàÁ¥ÑÁõ¥Êé•ËÆÄÂèñ VIP Á≠âÁ¥öÂíåÁ®ÖÁéáË≥áË®ä
    const { vipLevel, taxReduction, stakedAmount, isLoading: isLoadingVip, error: vipError } = useVipStatus();
    
    // SOUL ÂÉπÊ†ºÊï∏Êìö
    const { priceInUsd, formatSoulToUsd } = useSoulPrice();
    
    // Contract reads
    const playerProfileContract = getContractWithABI('PLAYERPROFILE');
    const dungeonMasterContract = getContractWithABI('DUNGEONMASTER');
    
    // Read player level from contract with caching
    const { data: levelData } = useCachedReadContract({
        address: playerProfileContract.address,
        abi: playerProfileContract.abi,
        functionName: 'getPlayerLevel',
        args: address ? [address] : undefined,
        query: { enabled: !!address },
        cacheKey: `playerLevel-${address}`,
        cacheTime: 300000 // 5 ÂàÜÈêòÁ∑©Â≠ò
    });
    
    // Read vault balance from contract with caching
    const { data: vaultBalance } = useCachedReadContract({
        address: dungeonMasterContract.address,
        abi: dungeonMasterContract.abi,
        functionName: 'getPlayerVaultBalance',
        args: address ? [address] : undefined,
        query: { enabled: !!address },
        cacheKey: `vaultBalance-${address}`,
        cacheTime: 60000 // 1 ÂàÜÈêòÁ∑©Â≠òÔºàÈáëÂ∫´È§òÈ°çËÆäÂåñËºÉÈ†ªÁπÅÔºâ
    });
    
    // Transaction hooks
    const claimVaultTx = useTransactionWithProgress({
        contractCall: {
            address: dungeonMasterContract.address,
            abi: dungeonMasterContract.abi,
            functionName: 'withdrawFromVault',
            args: []
        },
        actionName: 'È†òÂèñÈáëÂ∫´ÁçéÂãµ',
        onSuccess: (txHash) => {
            showToast('ÊàêÂäüÈ†òÂèñÈáëÂ∫´ÁçéÂãµÔºÅ', 'success');
            
            // Ë®òÈåÑÊàêÂäüÁöÑÊèêÂèñ‰∫§Êòì
            if (address) {
                const txRecord = createTransactionRecord(
                    'claim',
                    `ÊàêÂäüÊèêÂèñÈáëÂ∫´ÁçéÂãµ ${formatSoul(pendingVaultRewards)} SOUL`,
                    address,
                    56,
                    { amount: pendingVaultRewards }
                );
                const txId = addTransaction(txRecord);
                // Á´ãÂç≥Êõ¥Êñ∞ÁÇ∫ÊàêÂäüÁãÄÊÖã
                updateTransaction(txId, {
                    status: 'success',
                    hash: txHash,
                    confirmedAt: Date.now()
                });
            }
            
            refetch();
        },
        onError: (error) => {
            showToast(error, 'error');
            
            // Ë®òÈåÑÂ§±ÊïóÁöÑÊèêÂèñ‰∫§Êòì
            if (address) {
                const txRecord = createTransactionRecord(
                    'claim',
                    `ÊèêÂèñÈáëÂ∫´ÁçéÂãµÂ§±Êïó ${formatSoul(pendingVaultRewards)} SOUL`,
                    address,
                    56,
                    { amount: pendingVaultRewards, error }
                );
                const txId = addTransaction(txRecord);
                updateTransaction(txId, {
                    status: 'failed',
                    error: error
                });
            }
        }
    });

    // Parse data
    const player = data?.player;
    const playerVaults = data?.playerVaults?.[0];
    
    // Áç≤ÂèñÊú™ÂàÜÈÖçË≥áÁî¢Êï∏Êìö
    const { data: assetData, isLoading: isLoadingAssets } = useUnassignedAssets(address);
    
    // ‰ΩøÁî®Êú™ÂàÜÈÖçÁöÑËã±ÈõÑ/ËÅñÁâ©Êï∏ÈáèÔºåÂ¶ÇÊûúÈÇÑÂú®ËºâÂÖ•ÂâáÈ°ØÁ§∫Â≠êÂúñÊï∏Êìö
    const heroCount = isLoadingAssets 
        ? (player?.stats?.totalHeroes || player?.heros?.length || 0)
        : (assetData?.unassignedHeroes || 0);
    const relicCount = isLoadingAssets
        ? (player?.stats?.totalRelics || player?.relics?.length || 0)
        : (assetData?.unassignedRelics || 0);
    const partyCount = assetData?.totalParties || player?.stats?.totalParties || player?.parties?.length || 0;
    
    // ËôïÁêÜ 500+ ÁöÑÊÉÖÊ≥Å
    const displayHeroCount = player?.heros?.length >= 500 ? '500+' : heroCount.toString();
    const displayRelicCount = player?.relics?.length >= 500 ? '500+' : relicCount.toString();
    const displayPartyCount = player?.parties?.length >= 500 ? '500+' : partyCount.toString();
    const level = levelData ? Number(levelData) : (player?.profile?.level || 0);
    const pendingVaultRewards = vaultBalance ? formatEther(vaultBalance as bigint) : '0';
    // ‰ΩøÁî®ÂêàÁ¥ÑËÆÄÂèñÁöÑ VIP Á≠âÁ¥öÔºåËÄåÈùûÂ≠êÂúñÁöÑ tier
    const vipTier = vipLevel || 0;
    
    // Ë®àÁÆóÂØ¶ÈöõÁ®ÖÁéá
    const baseTaxRate = 25; // Âü∫Á§é 25%
    const vipDiscount = taxReduction ? Number(taxReduction) / 100 : 0; // ËΩâÊèõÁÇ∫ÁôæÂàÜÊØî
    const actualTaxRate = Math.max(0, baseTaxRate - vipDiscount);
    
    // È°ØÁ§∫Á®ÖÁéáË™™ÊòéÊ®°ÊÖãÊ°Ü
    const showTaxInfo = () => {
        setShowTaxModal(true);
    };
    
    // ËôïÁêÜÊèêÂèñÊåâÈàïÈªûÊìä
    const handleWithdrawClick = () => {
        if (Number(pendingVaultRewards) > 0) {
            claimVaultTx.execute();
        } else {
            showToast('ÈáëÂ∫´È§òÈ°çÁÇ∫ 0 SOULÔºåÁÑ°Ê≥ïÊèêÂèñ„ÄÇ\n\nüí° ÂÆåÊàêÂú∞ÂüéÊé¢Èö™ÂèØÁç≤ÂæóÁçéÂãµÔºÅ', 'warning');
        }
    };
    
    // Debug log
    if (import.meta.env.DEV) {
        console.log('Overview Page Data:', {
            vipLevel,
            vipTier,
            taxReduction: taxReduction?.toString(),
            stakedAmount: stakedAmount?.toString(),
            isLoadingVip,
            vipError,
            player,
            heroCount,
            relicCount,
            stats: player?.stats,
            rawVipData: player?.vip,
            rawHeroData: player?.heros,
            rawRelicData: player?.relics
        });
    }
    
    // Calculate unclaimed party rewards
    const unclaimedPartyRewards = useMemo(() => {
        if (!player?.parties) return '0';
        const total = player.parties.reduce((sum: bigint, party: any) => 
            sum + BigInt(party.unclaimedRewards || 0), BigInt(0)
        );
        return formatEther(total);
    }, [player?.parties]);
    
    // Profile data for SVG
    const profileData: ProfileData = {
        address: address || '0x0000000000000000000000000000000000000000',
        level,
        experience: BigInt(player?.profile?.experience || 0),
        nextLevelExp: BigInt(level * 100), // ÂÅáË®≠ÂÄº
        currentLevelExp: BigInt(player?.profile?.experience || 0),
        progress: 0, // ÂÅáË®≠ÂÄº
        heroCount: heroCount,
        relicCount: relicCount,
        partyCount: partyCount,
        expeditionCount: player?.profile?.successfulExpeditions || 0,
        totalRewards: BigInt(player?.profile?.totalRewardsEarned || 0)
    };
    
    if (isLoading) return <LoadingState />;
    if (isError) return <ErrorState onRetry={refetch} />;
    if (!isConnected) return <EmptyState message="Ë´ãÂÖàÈÄ£Êé•Èå¢ÂåÖ" />;

    return (
        <LocalErrorBoundary>
            <div className="space-y-6">
                {/* Header Section */}
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 className="text-2xl md:text-3xl font-bold text-white">Áé©ÂÆ∂Á∏ΩË¶Ω</h1>
                        <p className="text-gray-400 mt-1">ÁÆ°ÁêÜÊÇ®ÁöÑËã±ÈõÑÂíåËøΩËπ§ÈÄ≤Â∫¶</p>
                    </div>
                    <div className="flex gap-2">
                        <ActionButton
                            onClick={() => setShowProfileSVG(!showProfileSVG)}
                            className="px-4 py-2"
                        >
                            {showProfileSVG ? 'Èö±Ëóè' : 'È°ØÁ§∫'}Ê™îÊ°àÂç°Áâá
                        </ActionButton>
                        <ActionButton
                            onClick={() => {
                                refetch();
                                showToast('Ê≠£Âú®Âà∑Êñ∞Êï∏Êìö...', 'info');
                            }}
                            className="px-4 py-2"
                            title="Âà∑Êñ∞Êï∏Êìö"
                        >
                            <Icons.RefreshCw className="h-4 w-4" />
                        </ActionButton>
                    </div>
                </div>

                {/* Profile SVG Card */}
                {showProfileSVG && (
                    <div className="bg-gray-800 rounded-lg p-4 flex justify-center">
                        <div 
                            className="w-full max-w-md"
                            dangerouslySetInnerHTML={{ 
                                __html: generateProfileSVG(profileData) 
                            }} 
                        />
                    </div>
                )}

                {/* Stats Grid */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <StatCard
                        title="Á≠âÁ¥ö"
                        value={`LV ${level}`}
                        icon={<Icons.TrendingUp className="h-5 w-5" />}
                        description="ÈÄèÈÅéÊåëÊà∞Âú∞ÂüéÁç≤ÂæóÁ∂ìÈ©óÂÄºÊèêÂçáÁ≠âÁ¥ö"
                    />
                    
                    <StatCard
                        title="Ëã±ÈõÑÊï∏Èáè"
                        value={displayHeroCount}
                        icon={<Icons.Users className="h-5 w-5" />}
                        description={isLoadingAssets ? "ËºâÂÖ•‰∏≠..." : `Êú™ÂàÜÈÖçÂà∞Èöä‰ºçÁöÑËã±ÈõÑ`}
                        action={
                            <ActionButton
                                onClick={() => setActivePage('mint')}
                                className="text-xs px-2 py-1"
                            >
                                ÈëÑÈÄ†Ëã±ÈõÑ
                            </ActionButton>
                        }
                    />
                    
                    <StatCard
                        title="ËÅñÁâ©Êï∏Èáè"
                        value={displayRelicCount}
                        icon={<Icons.Shield className="h-5 w-5" />}
                        description={isLoadingAssets ? "ËºâÂÖ•‰∏≠..." : `ÂèØÁî®ËÅñÁâ©`}
                        action={
                            <ActionButton
                                onClick={() => setActivePage('mint')}
                                className="text-xs px-2 py-1"
                            >
                                ÈëÑÈÄ†ËÅñÁâ©
                            </ActionButton>
                        }
                    />
                    
                    <StatCard
                        title="Èöä‰ºçÊï∏Èáè"
                        value={displayPartyCount}
                        icon={<Icons.Users className="h-5 w-5" />}
                        action={
                            <ActionButton
                                onClick={() => setActivePage('myAssets')}
                                className="text-xs px-2 py-1"
                            >
                                ÁµÑÈöä
                            </ActionButton>
                        }
                    />
                    
                    <StatCard
                        title="ÈáëÂ∫´È§òÈ°ç"
                        value={`${formatSoul(pendingVaultRewards)} SOUL`}
                        icon={<Icons.DollarSign className="h-5 w-5" />}
                        description={
                            <div className="space-y-1">
                                <p className="text-xs text-gray-500">‚âà ${formatSoulToUsd(pendingVaultRewards)} USD</p>
                                <p className="text-xs text-gray-500">ÊèêÊ¨æÁ®ÖÁéáÔºö{actualTaxRate.toFixed(1)}% {vipTier > 0 ? `(VIP ${vipTier})` : ''}</p>
                            </div>
                        }
                        action={
                            <div className="flex gap-1">
                                <ActionButton
                                    onClick={handleWithdrawClick}
                                    isLoading={claimVaultTx.isLoading}
                                    className="text-xs px-2 py-1"
                                    disabled={Number(pendingVaultRewards) === 0}
                                    title={Number(pendingVaultRewards) > 0 ? 'ÊèêÂèñÈáëÂ∫´È§òÈ°ç' : 'ÈáëÂ∫´È§òÈ°çÁÇ∫Á©∫'}
                                >
                                    ÊèêÂèñ
                                </ActionButton>
                                <ActionButton
                                    onClick={showTaxInfo}
                                    className="text-xs px-2 py-1"
                                    title="Êü•ÁúãÁ®ÖÁéáË≥áË®äÂíåÊ∏õÂÖçË™™Êòé"
                                >
                                    Á®ÖÁéá
                                </ActionButton>
                                <WithdrawalHistoryButton userAddress={address} />
                            </div>
                        }
                    />
                    
                    <StatCard
                        title="VIP Á≠âÁ¥ö"
                        value={
                            isLoadingVip 
                                ? 'ËÆÄÂèñ‰∏≠...' 
                                : vipTier > 0 
                                    ? `VIP ${vipTier}` 
                                    : stakedAmount && stakedAmount > 0n 
                                        ? 'Ë®àÁÆó‰∏≠...' 
                                        : 'Êú™Âä†ÂÖ•'
                        }
                        icon={<Icons.Crown className="h-5 w-5" />}
                        description={
                            vipTier > 0 
                                ? `Ë≥™ÊäºÁç≤ÂæóÔºöÁ•≠Â£áÂä†Êàê„ÄÅÁ®ÖÁéáÊ∏õÂÖç„ÄÅÂú∞ÂüéÂä†Êàê`
                                : stakedAmount && stakedAmount > 0n
                                    ? `Â∑≤Ë≥™Êäº ${(Number(stakedAmount) / 1e18).toFixed(2)} SOUL`
                                    : "Ë≥™Êäº SoulShard Áç≤ÂæóÂ§öÈáçÊî∂ÁõäÂä†Êàê"
                        }
                        action={
                            <ActionButton
                                onClick={() => setActivePage('vip')}
                                className="text-xs px-2 py-1"
                                disabled={isLoadingVip}
                            >
                                {vipTier > 0 ? 'ÁÆ°ÁêÜ VIP' : 'ÊàêÁÇ∫ VIP'}
                            </ActionButton>
                        }
                    />
                </div>

                {/* Detailed Stats Section */}
                {player?.stats && (
                    <div className="bg-gray-800 rounded-lg p-6">
                        <h2 className="text-xl font-bold text-white mb-4">Ë©≥Á¥∞Áµ±Ë®à</h2>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="text-center">
                                <p className="text-2xl font-bold text-[#C0A573]">{player.stats.totalExpeditions || 0}</p>
                                <p className="text-sm text-gray-400">Á∏ΩÈÅ†ÂæÅÊ¨°Êï∏</p>
                            </div>
                            <div className="text-center">
                                <p className="text-2xl font-bold text-green-500">{player.stats.successfulExpeditions || 0}</p>
                                <p className="text-sm text-gray-400">ÊàêÂäüÈÅ†ÂæÅ</p>
                            </div>
                            <div className="text-center">
                                <p className="text-2xl font-bold text-blue-500">{formatLargeNumber(player.stats.highestPartyPower || 0)}</p>
                                <p className="text-sm text-gray-400">ÊúÄÈ´òÈöä‰ºçÊà∞Âäõ</p>
                            </div>
                            <div className="text-center">
                                <p className="text-2xl font-bold text-purple-500">{player.stats.totalUpgradeAttempts || 0}</p>
                                <p className="text-sm text-gray-400">ÂçáÁ¥öÂòóË©¶Ê¨°Êï∏</p>
                            </div>
                        </div>
                        
                        {/* È°çÂ§ñÁµ±Ë®àË°å */}
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mt-4">
                            <div className="text-center">
                                <p className="text-2xl font-bold text-orange-500">{player.stats.successfulUpgrades || 0}</p>
                                <p className="text-sm text-gray-400">ÊàêÂäüÂçáÁ¥öÊ¨°Êï∏</p>
                            </div>
                            <div className="text-center">
                                <p className="text-2xl font-bold text-yellow-500">{formatSoul(player.stats.totalRewardsEarned || 0)} SOUL</p>
                                <p className="text-sm text-gray-400">Á∏ΩÁç≤ÂæóÁçéÂãµ</p>
                            </div>
                            <div className="text-center">
                                <p className="text-2xl font-bold text-cyan-500">
                                    {player.stats.totalExpeditions > 0 
                                        ? `${Math.round((player.stats.successfulExpeditions / player.stats.totalExpeditions) * 100)}%`
                                        : '0%'
                                    }
                                </p>
                                <p className="text-sm text-gray-400">ÈÅ†ÂæÅÊàêÂäüÁéá</p>
                            </div>
                        </div>
                        {player.profile?.inviter && (
                            <div className="mt-4 pt-4 border-t border-gray-700">
                                <p className="text-sm text-gray-400">
                                    Êé®Ëñ¶‰∫∫Ôºö<span className="text-white">{player.profile.inviter}</span>
                                </p>
                                <p className="text-sm text-gray-400">
                                    ÂÇ≠ÈáëÊî∂ÂÖ•Ôºö<span className="text-[#C0A573]">{formatSoul(player.profile.commissionEarned || '0')} SOUL</span>
                                </p>
                            </div>
                        )}
                    </div>
                )}

                {/* Expedition Tracker */}
                <ExpeditionTracker />

                {/* Town Bulletin */}
                <TownBulletin />

                {/* Actions Section */}
                <div className="bg-gray-800 rounded-lg p-6">
                    <h2 className="text-xl font-bold text-white mb-4">Âø´ÈÄüË°åÂãï</h2>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button
                            onClick={() => setActivePage('mint')}
                            className="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-105 hover:shadow-lg"
                        >
                            <span className="text-2xl">üéØ</span>
                            <span className="font-medium">ÈëÑÈÄ†NFT</span>
                        </button>
                        <button
                            onClick={() => setActivePage('altar')}
                            className="bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-105 hover:shadow-lg"
                        >
                            <span className="text-2xl">‚≠ê</span>
                            <span className="font-medium">ÂçáÁ¥öNFT</span>
                        </button>
                        <button
                            onClick={() => setActivePage('myAssets')}
                            className="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-105 hover:shadow-lg"
                        >
                            <span className="text-2xl">üìä</span>
                            <span className="font-medium">Êü•ÁúãË≥áÁî¢</span>
                        </button>
                        <button
                            onClick={() => setActivePage('dungeon')}
                            className="bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-105 hover:shadow-lg"
                        >
                            <span className="text-2xl">üè∞</span>
                            <span className="font-medium">Êé¢Á¥¢Âú∞Âüé</span>
                        </button>
                    </div>
                </div>

                {/* Project Introduction Section */}
                <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-white mb-2">üåü Ë∏èÂÖ• Soulbound SagaÔºåË≠úÂØ´ÊÇ®ÁöÑÊï∏‰ΩçÂÇ≥Â•á</h2>
                        <p className="text-gray-400">ÂÆåÂÖ®‰∏äÈèàÁöÑ Roguelike ÂÇ≥Â•áÔºåÊØèÂÄãÊ±∫Á≠ñÈÉΩË¢´Ê∞∏ÊÅÜË®òÈåÑÔºåÊØèÂÄãÊàêÂ∞±ÈÉΩÁÑ°Ê≥ïË¢´Â•™Ëµ∞</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div className="text-center">
                            <div className="bg-gradient-to-br from-blue-500 to-purple-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span className="text-2xl">‚öîÔ∏è</span>
                            </div>
                            <h3 className="text-lg font-semibold text-white mb-2">Âè¨ÂñöËã±ÈõÑ</h3>
                            <p className="text-sm text-gray-400">Âè¨ÂñöÈùàÈ≠ÇÁ∂ÅÂÆöÁöÑËã±ÈõÑ NFTÔºåÊØèÂÄãÈÉΩÊìÅÊúâÁç®ÁâπÁöÑÈùàÈ≠ÇÂ•ëÁ¥ÑÂíåËÉΩÂäõ</p>
                        </div>

                        <div className="text-center">
                            <div className="bg-gradient-to-br from-purple-500 to-pink-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span className="text-2xl">üõ°Ô∏è</span>
                            </div>
                            <h3 className="text-lg font-semibold text-white mb-2">ÈçõÈÄ†È≠ÇÂô®</h3>
                            <p className="text-sm text-gray-400">ÈçõÈÄ†Á•ûÁßòÁöÑÈ≠ÇÂô®ËÅñÁâ©ÔºåÊèêÂçáËã±ÈõÑÂäõÈáè‰∏¶Ëß£ÈéñÊñ∞ÁöÑÈùàÈ≠ÇËÉΩÂäõ</p>
                        </div>

                        <div className="text-center">
                            <div className="bg-gradient-to-br from-green-500 to-teal-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span className="text-2xl">üè∞</span>
                            </div>
                            <h3 className="text-lg font-semibold text-white mb-2">Êé¢Á¥¢ÈùàÂ¢É</h3>
                            <p className="text-sm text-gray-400">ÁµÑÂª∫Èöä‰ºçÈÄ≤ÂÖ•Á®ãÂ∫èÁîüÊàêÁöÑÈùàÂ¢ÉÂú∞ÂüéÔºåÊåëÊà∞ÈùàÈ≠ÇÂÆàË≠∑ËÄÖ</p>
                        </div>

                        <div className="text-center">
                            <div className="bg-gradient-to-br from-orange-500 to-red-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span className="text-2xl">üí∞</span>
                            </div>
                            <h3 className="text-lg font-semibold text-white mb-2">Êî∂ÈõÜ $SOUL</h3>
                            <p className="text-sm text-gray-400">ÈÄöÈÅéÈùàÂ¢ÉÊé¢Á¥¢ÂíåÊà∞È¨•Êî∂ÈõÜÁèçË≤¥ÁöÑ $SOUL ‰ª£Âπ£ÔºåÁØâÂª∫ÊÇ®ÁöÑÊï∏‰ΩçË≤°ÂØå</p>
                        </div>
                    </div>

                    <div className="border-t border-gray-700 pt-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="bg-gray-700/50 rounded-lg p-4">
                                <h4 className="text-white font-semibold mb-2 flex items-center gap-2">
                                    <span className="text-blue-400">‚õìÔ∏è</span>
                                    ‰∏äÈèàÊ©üÂà∂
                                </h4>
                                <ul className="text-sm text-gray-400 space-y-1">
                                    <li>‚Ä¢ ÂÆåÂÖ®‰∏äÈèàÁöÑ Roguelike Ê©üÂà∂</li>
                                    <li>‚Ä¢ ÂèØÈ©óË≠âÁöÑÈö®Ê©üÊÄßÂíåÈÄèÊòéÂ∫¶</li>
                                    <li>‚Ä¢ ÈùàÈ≠ÇÁ∂ÅÂÆöÁöÑ NFT Ë≥áÁî¢</li>
                                    <li>‚Ä¢ ‰∏çÂèØÁØ°ÊîπÁöÑÈÅäÊà≤ÊàêÂ∞±</li>
                                </ul>
                            </div>

                            <div className="bg-gray-700/50 rounded-lg p-4">
                                <h4 className="text-white font-semibold mb-2 flex items-center gap-2">
                                    <span className="text-green-400">üíé</span>
                                    $SOUL Á∂ìÊøü
                                </h4>
                                <ul className="text-sm text-gray-400 space-y-1">
                                    <li>‚Ä¢ ÈÄöÁ∏ÆÊÄß $SOUL ‰ª£Âπ£Á∂ìÊøü</li>
                                    <li>‚Ä¢ ÈùàÈ≠ÇË≥™Êäº VIP Á≥ªÁµ±</li>
                                    <li>‚Ä¢ ÂèØÊåÅÁ∫åÁöÑÈÅäÊà≤Âç≥Êî∂Áõä</li>
                                    <li>‚Ä¢ Á§æÁæ§È©ÖÂãïÁöÑ DAO Ê≤ªÁêÜ</li>
                                </ul>
                            </div>

                            <div className="bg-gray-700/50 rounded-lg p-4">
                                <h4 className="text-white font-semibold mb-2 flex items-center gap-2">
                                    <span className="text-purple-400">üåê</span>
                                    Á§æÁæ§ÈÄ£Áµê
                                </h4>
                                <div className="space-y-2">
                                    <a href="https://t.me/Soulbound_Saga" target="_blank" rel="noreferrer" className="text-blue-400 hover:text-blue-300 text-sm block transition-colors">
                                        üì± Telegram Á§æÁæ§
                                    </a>
                                    <a href="https://x.com/Soulbound_Saga" target="_blank" rel="noreferrer" className="text-blue-400 hover:text-blue-300 text-sm block transition-colors">
                                        üê¶ Twitter ÂÆòÊñπ
                                    </a>
                                    <a href="https://soulshard.gitbook.io/dungeon-delvers/" target="_blank" rel="noreferrer" className="text-blue-400 hover:text-blue-300 text-sm block transition-colors">
                                        üìò ÈÅäÊà≤ÊñáÊ™î
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="text-center mt-6 pt-4 border-t border-gray-700">
                        <p className="text-gray-400 text-sm">
                            üåü ÁèæÂú®Â∞±Ë∏èÂÖ• Soulbound SagaÔºÅÈÄ£Êé•Èå¢ÂåÖ‰∏¶Âè¨ÂñöÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄãÈùàÈ≠ÇËã±ÈõÑ
                        </p>
                    </div>
                </div>
            </div>

            {/* Transaction Progress Modal */}
            <TransactionProgressModal
                isOpen={claimVaultTx.showProgress}
                onClose={() => claimVaultTx.setShowProgress(false)}
                status={claimVaultTx.status}
                error={claimVaultTx.error}
                txHash={claimVaultTx.txHash}
                actionName={claimVaultTx.actionName}
            />

            {/* Tax Rate Modal */}
            <TaxRateModal
                isOpen={showTaxModal}
                onClose={() => setShowTaxModal(false)}
                vipTier={vipTier}
                actualTaxRate={actualTaxRate}
                vipDiscount={vipDiscount}
            />
        </LocalErrorBoundary>
    );
};

export default OverviewPage;