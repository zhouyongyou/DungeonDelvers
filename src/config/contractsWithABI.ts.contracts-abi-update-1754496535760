// V25 Contract Configuration with ABI
// Generated on 2025-08-06T12:55:06.052Znc-all.js to update

import HeroArtifact from '../abis/Hero.json';
import RelicArtifact from '../abis/Relic.json';
import PartyArtifact from '../abis/Party.json';
import DungeonCoreArtifact from '../abis/DungeonCore.json';
import DungeonMasterArtifact from '../abis/DungeonMaster.json';
import PlayerProfileArtifact from '../abis/PlayerProfile.json';
import VIPStakingArtifact from '../abis/VIPStaking.json';
import OracleArtifact from '../abis/Oracle.json';
import AltarOfAscensionArtifact from '../abis/AltarOfAscension.json';
import PlayerVaultArtifact from '../abis/PlayerVault.json';
import DungeonStorageArtifact from '../abis/DungeonStorage.json';
import SoulShardTokenArtifact from '../abis/SoulShardToken.json';
import VRFManagerArtifact from '../abis/VRFManager.json';

// Extract ABI from artifacts
const HeroABI = HeroArtifact.abi || HeroArtifact;
const RelicABI = RelicArtifact.abi || RelicArtifact;
const PartyABI = PartyArtifact.abi || PartyArtifact;
const DungeonCoreABI = DungeonCoreArtifact.abi || DungeonCoreArtifact;
const DungeonMasterABI = DungeonMasterArtifact.abi || DungeonMasterArtifact;
const PlayerProfileABI = PlayerProfileArtifact.abi || PlayerProfileArtifact;
const VIPStakingABI = VIPStakingArtifact.abi || VIPStakingArtifact;
const OracleABI = OracleArtifact.abi || OracleArtifact;
const AltarOfAscensionABI = AltarOfAscensionArtifact.abi || AltarOfAscensionArtifact;
const PlayerVaultABI = PlayerVaultArtifact.abi || PlayerVaultArtifact;
const DungeonStorageABI = DungeonStorageArtifact.abi || DungeonStorageArtifact;
const SoulShardTokenABI = SoulShardTokenArtifact.abi || SoulShardTokenArtifact;
const VRFManagerABI = VRFManagerArtifact.abi || VRFManagerArtifact;

export interface ContractWithABI {
  address: string;
  abi: any;
}

export const CONTRACTS_WITH_ABI = {
  56: { // BSC Mainnet
    // NFT Contracts - V25 Updated (修復正確地址)
    HERO: {
      address: '0xD48867dbac5f1c1351421726B6544f847D9486af',
      abi: HeroABI
    },
    RELIC: {
      address: '0x86f15792Ecfc4b5F2451d841A3fBaBEb651138ce',
      abi: RelicABI
    },
    PARTY: {
      address: '0x28A85D14e0F87d6eD04e21c30992Df8B3e9434E3',
      abi: PartyABI
    },
    
    // Core Contracts - V25 Updated
    DUNGEONCORE: {
      address: '0x8a2D2b1961135127228EdD71Ff98d6B097915a13',
      abi: DungeonCoreABI
    },
    DUNGEONMASTER: {
      address: '0xE391261741Fad5FCC2D298d00e8c684767021253',
      abi: DungeonMasterABI
    },
    PLAYERPROFILE: {
      address: '0x0f5932e89908400a5AfDC306899A2987b67a3155',
      abi: PlayerProfileABI
    },
    VIPSTAKING: {
      address: '0xC0D8C84e28E5BcfC9cBD109551De53BA04e7328C',
      abi: VIPStakingABI
    },
    ORACLE: {
      address: '0xf8CE896aF39f95a9d5Dd688c35d381062263E25a',
      abi: OracleABI
    },
    ALTAROFASCENSION: {
      address: '0x095559778C0BAA2d8FA040Ab0f8752cF07779D33',
      abi: AltarOfAscensionABI
    },
    PLAYERVAULT: {
      address: '0x62Bce9aF5E2C47b13f62A2e0fCB1f9C7AfaF8787',
      abi: PlayerVaultABI
    },
    DUNGEONSTORAGE: {
      address: '0x539AC926C6daE898f2C843aF8C59Ff92B4b3B468',
      abi: DungeonStorageABI
    },
    
    // VRF System - V25 New (VRFManagerV2Plus)
    VRFMANAGER: {
      address: '0xFac10cd51981ED3aE85a05c5CFF6ab5b8e145038',
      abi: VRFManagerABI
    },
    
    // Token Contracts
    SOULSHARD: {
      address: '0x97B2C2a9A11C7b6A020b4bAEaAd349865eaD0bcF',
      abi: SoulShardTokenABI
    },
    
    // Additional Addresses (from master-config.json)
    USD: {
      address: '0x7C67Af4EBC6651c95dF78De11cfe325660d935FE',
      abi: [] // USD Token ABI if needed
    },
    UNISWAP_POOL: {
      address: '0x1e5Cd5F386Fb6F39cD8788675dd3A5ceB6521C82',
      abi: [] // Uniswap V3 Pool ABI if needed
    },
    DUNGEONMASTERWALLET: {
      address: '0x10925A7138649C7E1794CE646182eeb5BF8ba647',
      abi: [] // This is a wallet address, not a contract
    }
  }
} as const;

// Contract version for tracking
export const CONTRACT_VERSION = 'V25';

// Helper function to get contract with ABI - supports both signatures
export function getContractWithABI(name: keyof typeof CONTRACTS_WITH_ABI[56]): ContractWithABI;
export function getContractWithABI(chainId: number, name: string): ContractWithABI | undefined;
export function getContractWithABI(
  nameOrChainId: keyof typeof CONTRACTS_WITH_ABI[56] | number,
  nameIfChainId?: string
): ContractWithABI | undefined {
  // Support old signature: getContractWithABI(name)
  if (typeof nameOrChainId === 'string') {
    return CONTRACTS_WITH_ABI[56][nameOrChainId];
  }
  
  // Support new signature: getContractWithABI(chainId, name)
  const chainId = nameOrChainId as number;
  const name = nameIfChainId!;
  
  // Convert contract name to uppercase to match the keys
  const upperName = name.toUpperCase();
  
  // Check if chainId exists in CONTRACTS_WITH_ABI
  if (!(chainId in CONTRACTS_WITH_ABI)) {
    console.warn(`Chain ID ${chainId} not found in CONTRACTS_WITH_ABI`);
    return undefined;
  }
  
  const chainContracts = CONTRACTS_WITH_ABI[chainId as keyof typeof CONTRACTS_WITH_ABI];
  
  // Check if contract exists for this chain
  if (!(upperName in chainContracts)) {
    console.warn(`Contract ${name} (${upperName}) not found for chain ${chainId}`);
    return undefined;
  }
  
  return chainContracts[upperName as keyof typeof chainContracts];
}

/**
 * @deprecated Use getContractWithABI() instead. This function only returns the address.
 * Legacy compatibility function - will be removed in future versions.
 */
export const getContract = (name: keyof typeof CONTRACTS_WITH_ABI[56]): string => {
  console.warn(`⚠️ getContract('${name}') is deprecated. Use getContractWithABI('${name}') instead.`);
  return CONTRACTS_WITH_ABI[56][name].address;
};

// Export contract info for debugging
export const CONTRACT_INFO = {
  version: CONTRACT_VERSION,
  network: "BSC Mainnet",
  deploymentBlock: 56184733,
  lastUpdated: "2025-08-05T17:45:54.340Z"
};
