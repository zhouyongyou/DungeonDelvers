# 🌐 Dungeon Delvers 具體調用網址清單

## 1. 🎯 The Graph API (GraphQL 子圖)

### 主要端點
```
https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest
```

### 查詢方式
```javascript
// POST 請求
fetch('https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: `
      query GetPlayerAssets($owner: ID!) {
        player(id: $owner) {
          heroes { id tokenId power rarity }
          relics { id tokenId capacity rarity }
          parties { id tokenId totalPower }
          vip { id tokenId stakedAmount level }
        }
      }
    `,
    variables: { owner: "0x..." }
  })
})
```

### 調用位置
- `src/api/nfts.ts` - NFT 數據獲取
- `src/pages/ProfilePage.tsx` - 玩家檔案
- `src/pages/DashboardPage.tsx` - 儀表板
- `src/pages/ExplorerPage.tsx` - 探索頁面
- `src/pages/ReferralPage.tsx` - 推薦系統
- `src/pages/CodexPage.tsx` - 圖鑑系統
- `src/pages/AltarPage.tsx` - 祭壇頁面
- `src/pages/DungeonPage.tsx` - 地下城頁面

## 2. 🖥️ Metadata Server API (後端伺服器)

### 主要端點
```
http://localhost:3001/
```

### 所有 API 端點
```
GET /api/hero/:tokenId          # 英雄 NFT 元數據
GET /api/relic/:tokenId         # 聖物 NFT 元數據
GET /api/party/:tokenId         # 隊伍 NFT 元數據
GET /api/vip/:tokenId           # VIP NFT 元數據
GET /api/profile/:tokenId       # 玩家檔案 NFT 元數據
GET /health                     # 健康檢查
GET /admin/cache/stats          # 快取統計
POST /admin/cache/clear         # 清除快取
POST /admin/cache/preload       # 預熱快取
GET /admin/metrics              # 性能指標
```

### 調用範例
```javascript
// 獲取英雄 NFT 元數據
fetch('http://localhost:3001/api/hero/123')
  .then(response => response.json())
  .then(data => console.log(data));

// 獲取健康狀態
fetch('http://localhost:3001/health')
  .then(response => response.json())
  .then(data => console.log(data));
```

### 實現位置
- **後端**: `dungeon-delvers-metadata-server/src/index.js`
- **前端調用**: `src/api/nfts.ts` 的 `fetchMetadata()` 函數

## 3. 🌍 IPFS 網關 (去中心化存儲)

### 主要網關列表
```
https://ipfs.io/ipfs/
https://gateway.pinata.cloud/ipfs/
https://cloudflare-ipfs.com/ipfs/
https://dweb.link/ipfs/
```

### 調用方式
```javascript
// 並行請求多個 IPFS 網關
const ipfsHash = "QmYourIPFSHash";
const gateways = [
  `https://ipfs.io/ipfs/${ipfsHash}`,
  `https://gateway.pinata.cloud/ipfs/${ipfsHash}`,
  `https://cloudflare-ipfs.com/ipfs/${ipfsHash}`,
  `https://dweb.link/ipfs/${ipfsHash}`
];

// 使用最快回應的網關
Promise.allSettled(gateways.map(url => fetch(url)))
  .then(results => {
    const firstSuccessful = results.find(r => r.status === 'fulfilled');
    return firstSuccessful.value.json();
  });
```

### 調用位置
- `src/api/nfts.ts` - `fetchWithMultipleGateways()` 函數
- `src/components/ui/NftCard.tsx` - 圖片顯示

## 4. 🔗 BSC 區塊鏈 RPC 端點

### 主要 RPC 端點
```
https://bsc-dataseed1.binance.org/
https://bsc-dataseed2.binance.org/
https://bsc-dataseed3.binance.org/
```

### 備用 RPC 端點 (如果有配置)
```
VITE_ALCHEMY_BSC_MAINNET_RPC_URL      # Alchemy BSC RPC
VITE_INFURA_BSC_MAINNET_RPC_URL       # Infura BSC RPC
VITE_ANKR_BSC_MAINNET_RPC_URL         # Ankr BSC RPC
```

### 調用方式
```javascript
// 使用 Wagmi/Viem 調用智能合約
const { data: tokenURI } = useReadContract({
  address: "0x...", // 合約地址
  abi: contractAbi,
  functionName: 'tokenURI',
  args: [tokenId],
});
```

### 調用位置
- `src/wagmi.ts` - Wagmi 配置
- 所有使用 `useReadContract` 的組件

## 5. 🎮 主要網站域名

### 生產環境
```
https://www.dungeondelvers.xyz/
```

### 本地開發環境
```
http://localhost:5173/
```

### 語言文件路徑
```
https://www.dungeondelvers.xyz/locales/zh-TW/common.json
https://www.dungeondelvers.xyz/locales/en/common.json
https://www.dungeondelvers.xyz/locales/ja/common.json
https://www.dungeondelvers.xyz/locales/ko/common.json
```

## 6. 🔍 具體智能合約地址

### 主要 NFT 合約
```javascript
// 這些是環境變數，實際地址需要查看 .env 文件
VITE_MAINNET_HERO_ADDRESS              # 英雄 NFT 合約
VITE_MAINNET_RELIC_ADDRESS             # 聖物 NFT 合約
VITE_MAINNET_PARTY_ADDRESS             # 隊伍 NFT 合約
VITE_MAINNET_VIPSTAKING_ADDRESS        # VIP 質押合約
VITE_MAINNET_PLAYERPROFILE_ADDRESS     # 玩家檔案合約
VITE_MAINNET_DUNGEONCORE_ADDRESS       # 地下城核心合約
VITE_MAINNET_ORACLE_ADDRESS            # 價格預言機合約
VITE_MAINNET_SOUL_SHARD_TOKEN_ADDRESS  # 靈魂碎片代幣合約
```

### 調用方式
```javascript
// 讀取合約數據
const vipLevel = await publicClient.readContract({
  address: "0x...", // VIP 合約地址
  abi: vipStakingAbi,
  functionName: 'getVipLevel',
  args: [userAddress]
});
```

## 7. 📡 完整的 API 調用流程

### 獲取 NFT 元數據的完整流程
```javascript
// 1. 先查詢 The Graph API 獲取 NFT 基本信息
const response = await fetch('https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest', {
  method: 'POST',
  body: JSON.stringify({
    query: GET_PLAYER_ASSETS_QUERY,
    variables: { owner: address.toLowerCase() }
  })
});

// 2. 調用智能合約獲取 tokenURI
const tokenURI = await publicClient.readContract({
  address: heroContractAddress,
  abi: heroAbi,
  functionName: 'tokenURI',
  args: [tokenId]
});

// 3. 根據 tokenURI 類型調用不同的端點
if (tokenURI.startsWith('ipfs://')) {
  // 調用 IPFS 網關
  const ipfsHash = tokenURI.replace('ipfs://', '');
  const metadata = await fetch(`https://ipfs.io/ipfs/${ipfsHash}`);
} else if (tokenURI.startsWith('http://localhost:3001/')) {
  // 調用本地 Metadata Server
  const metadata = await fetch(tokenURI);
}
```

## 8. 🛡️ 錯誤處理和備用方案

### 常見錯誤和對應網址
```javascript
// 429 錯誤：The Graph API 限流
// 主要端點: https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest
// 解決方案: 使用 Apollo Client 緩存策略

// 404 錯誤：語言文件不存在
// 錯誤URL: https://www.dungeondelvers.xyz/locales/zh-TW/translation.json (不存在)
// 正確URL: https://www.dungeondelvers.xyz/locales/zh-TW/common.json (存在)

// IPFS 網關故障
// 主要網關: https://ipfs.io/ipfs/
// 備用網關: https://gateway.pinata.cloud/ipfs/
// 備用網關: https://cloudflare-ipfs.com/ipfs/
```

## 9. 📊 監控和管理端點

### 開發環境監控
```
http://localhost:3001/health          # 服務健康檢查
http://localhost:3001/admin/cache/stats  # 快取統計
http://localhost:3001/admin/metrics    # 性能指標
```

### 生產環境監控 (如果部署)
```
https://api.dungeondelvers.xyz/health
https://api.dungeondelvers.xyz/admin/cache/stats
https://api.dungeondelvers.xyz/admin/metrics
```

## 10. 🚀 總結

您的 Dungeon Delvers 項目主要調用以下網址：

1. **The Graph API**: `https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest`
2. **Metadata Server**: `http://localhost:3001/api/`
3. **IPFS 網關**: `https://ipfs.io/ipfs/`、`https://gateway.pinata.cloud/ipfs/` 等
4. **BSC RPC**: `https://bsc-dataseed1.binance.org/`
5. **主網站**: `https://www.dungeondelvers.xyz/`

所有這些端點都是分佈式的，確保了高可用性和性能。