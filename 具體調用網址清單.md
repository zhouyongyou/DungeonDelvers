# ğŸŒ Dungeon Delvers å…·é«”èª¿ç”¨ç¶²å€æ¸…å–®

## 1. ğŸ¯ The Graph API (GraphQL å­åœ–)

### ä¸»è¦ç«¯é»
```
https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest
```

### æŸ¥è©¢æ–¹å¼
```javascript
// POST è«‹æ±‚
fetch('https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: `
      query GetPlayerAssets($owner: ID!) {
        player(id: $owner) {
          heroes { id tokenId power rarity }
          relics { id tokenId capacity rarity }
          parties { id tokenId totalPower }
          vip { id tokenId stakedAmount level }
        }
      }
    `,
    variables: { owner: "0x..." }
  })
})
```

### èª¿ç”¨ä½ç½®
- `src/api/nfts.ts` - NFT æ•¸æ“šç²å–
- `src/pages/ProfilePage.tsx` - ç©å®¶æª”æ¡ˆ
- `src/pages/DashboardPage.tsx` - å„€è¡¨æ¿
- `src/pages/ExplorerPage.tsx` - æ¢ç´¢é é¢
- `src/pages/ReferralPage.tsx` - æ¨è–¦ç³»çµ±
- `src/pages/CodexPage.tsx` - åœ–é‘‘ç³»çµ±
- `src/pages/AltarPage.tsx` - ç¥­å£‡é é¢
- `src/pages/DungeonPage.tsx` - åœ°ä¸‹åŸé é¢

## 2. ğŸ–¥ï¸ Metadata Server API (å¾Œç«¯ä¼ºæœå™¨)

### ä¸»è¦ç«¯é»
```
http://localhost:3001/
```

### æ‰€æœ‰ API ç«¯é»
```
GET /api/hero/:tokenId          # è‹±é›„ NFT å…ƒæ•¸æ“š
GET /api/relic/:tokenId         # è–ç‰© NFT å…ƒæ•¸æ“š
GET /api/party/:tokenId         # éšŠä¼ NFT å…ƒæ•¸æ“š
GET /api/vip/:tokenId           # VIP NFT å…ƒæ•¸æ“š
GET /api/profile/:tokenId       # ç©å®¶æª”æ¡ˆ NFT å…ƒæ•¸æ“š
GET /health                     # å¥åº·æª¢æŸ¥
GET /admin/cache/stats          # å¿«å–çµ±è¨ˆ
POST /admin/cache/clear         # æ¸…é™¤å¿«å–
POST /admin/cache/preload       # é ç†±å¿«å–
GET /admin/metrics              # æ€§èƒ½æŒ‡æ¨™
```

### èª¿ç”¨ç¯„ä¾‹
```javascript
// ç²å–è‹±é›„ NFT å…ƒæ•¸æ“š
fetch('http://localhost:3001/api/hero/123')
  .then(response => response.json())
  .then(data => console.log(data));

// ç²å–å¥åº·ç‹€æ…‹
fetch('http://localhost:3001/health')
  .then(response => response.json())
  .then(data => console.log(data));
```

### å¯¦ç¾ä½ç½®
- **å¾Œç«¯**: `dungeon-delvers-metadata-server/src/index.js`
- **å‰ç«¯èª¿ç”¨**: `src/api/nfts.ts` çš„ `fetchMetadata()` å‡½æ•¸

## 3. ğŸŒ IPFS ç¶²é—œ (å»ä¸­å¿ƒåŒ–å­˜å„²)

### ä¸»è¦ç¶²é—œåˆ—è¡¨
```
https://ipfs.io/ipfs/
https://gateway.pinata.cloud/ipfs/
https://cloudflare-ipfs.com/ipfs/
https://dweb.link/ipfs/
```

### èª¿ç”¨æ–¹å¼
```javascript
// ä¸¦è¡Œè«‹æ±‚å¤šå€‹ IPFS ç¶²é—œ
const ipfsHash = "QmYourIPFSHash";
const gateways = [
  `https://ipfs.io/ipfs/${ipfsHash}`,
  `https://gateway.pinata.cloud/ipfs/${ipfsHash}`,
  `https://cloudflare-ipfs.com/ipfs/${ipfsHash}`,
  `https://dweb.link/ipfs/${ipfsHash}`
];

// ä½¿ç”¨æœ€å¿«å›æ‡‰çš„ç¶²é—œ
Promise.allSettled(gateways.map(url => fetch(url)))
  .then(results => {
    const firstSuccessful = results.find(r => r.status === 'fulfilled');
    return firstSuccessful.value.json();
  });
```

### èª¿ç”¨ä½ç½®
- `src/api/nfts.ts` - `fetchWithMultipleGateways()` å‡½æ•¸
- `src/components/ui/NftCard.tsx` - åœ–ç‰‡é¡¯ç¤º

## 4. ğŸ”— BSC å€å¡Šéˆ RPC ç«¯é»

### ä¸»è¦ RPC ç«¯é»
```
https://bsc-dataseed1.binance.org/
https://bsc-dataseed2.binance.org/
https://bsc-dataseed3.binance.org/
```

### å‚™ç”¨ RPC ç«¯é» (å¦‚æœæœ‰é…ç½®)
```
VITE_ALCHEMY_BSC_MAINNET_RPC_URL      # Alchemy BSC RPC
VITE_INFURA_BSC_MAINNET_RPC_URL       # Infura BSC RPC
VITE_ANKR_BSC_MAINNET_RPC_URL         # Ankr BSC RPC
```

### èª¿ç”¨æ–¹å¼
```javascript
// ä½¿ç”¨ Wagmi/Viem èª¿ç”¨æ™ºèƒ½åˆç´„
const { data: tokenURI } = useReadContract({
  address: "0x...", // åˆç´„åœ°å€
  abi: contractAbi,
  functionName: 'tokenURI',
  args: [tokenId],
});
```

### èª¿ç”¨ä½ç½®
- `src/wagmi.ts` - Wagmi é…ç½®
- æ‰€æœ‰ä½¿ç”¨ `useReadContract` çš„çµ„ä»¶

## 5. ğŸ® ä¸»è¦ç¶²ç«™åŸŸå

### ç”Ÿç”¢ç’°å¢ƒ
```
https://www.dungeondelvers.xyz/
```

### æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
```
http://localhost:5173/
```

### èªè¨€æ–‡ä»¶è·¯å¾‘
```
https://www.dungeondelvers.xyz/locales/zh-TW/common.json
https://www.dungeondelvers.xyz/locales/en/common.json
https://www.dungeondelvers.xyz/locales/ja/common.json
https://www.dungeondelvers.xyz/locales/ko/common.json
```

## 6. ğŸ” å…·é«”æ™ºèƒ½åˆç´„åœ°å€

### ä¸»è¦ NFT åˆç´„
```javascript
// é€™äº›æ˜¯ç’°å¢ƒè®Šæ•¸ï¼Œå¯¦éš›åœ°å€éœ€è¦æŸ¥çœ‹ .env æ–‡ä»¶
VITE_MAINNET_HERO_ADDRESS              # è‹±é›„ NFT åˆç´„
VITE_MAINNET_RELIC_ADDRESS             # è–ç‰© NFT åˆç´„
VITE_MAINNET_PARTY_ADDRESS             # éšŠä¼ NFT åˆç´„
VITE_MAINNET_VIPSTAKING_ADDRESS        # VIP è³ªæŠ¼åˆç´„
VITE_MAINNET_PLAYERPROFILE_ADDRESS     # ç©å®¶æª”æ¡ˆåˆç´„
VITE_MAINNET_DUNGEONCORE_ADDRESS       # åœ°ä¸‹åŸæ ¸å¿ƒåˆç´„
VITE_MAINNET_ORACLE_ADDRESS            # åƒ¹æ ¼é è¨€æ©Ÿåˆç´„
VITE_MAINNET_SOUL_SHARD_TOKEN_ADDRESS  # éˆé­‚ç¢ç‰‡ä»£å¹£åˆç´„
```

### èª¿ç”¨æ–¹å¼
```javascript
// è®€å–åˆç´„æ•¸æ“š
const vipLevel = await publicClient.readContract({
  address: "0x...", // VIP åˆç´„åœ°å€
  abi: vipStakingAbi,
  functionName: 'getVipLevel',
  args: [userAddress]
});
```

## 7. ğŸ“¡ å®Œæ•´çš„ API èª¿ç”¨æµç¨‹

### ç²å– NFT å…ƒæ•¸æ“šçš„å®Œæ•´æµç¨‹
```javascript
// 1. å…ˆæŸ¥è©¢ The Graph API ç²å– NFT åŸºæœ¬ä¿¡æ¯
const response = await fetch('https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest', {
  method: 'POST',
  body: JSON.stringify({
    query: GET_PLAYER_ASSETS_QUERY,
    variables: { owner: address.toLowerCase() }
  })
});

// 2. èª¿ç”¨æ™ºèƒ½åˆç´„ç²å– tokenURI
const tokenURI = await publicClient.readContract({
  address: heroContractAddress,
  abi: heroAbi,
  functionName: 'tokenURI',
  args: [tokenId]
});

// 3. æ ¹æ“š tokenURI é¡å‹èª¿ç”¨ä¸åŒçš„ç«¯é»
if (tokenURI.startsWith('ipfs://')) {
  // èª¿ç”¨ IPFS ç¶²é—œ
  const ipfsHash = tokenURI.replace('ipfs://', '');
  const metadata = await fetch(`https://ipfs.io/ipfs/${ipfsHash}`);
} else if (tokenURI.startsWith('http://localhost:3001/')) {
  // èª¿ç”¨æœ¬åœ° Metadata Server
  const metadata = await fetch(tokenURI);
}
```

## 8. ğŸ›¡ï¸ éŒ¯èª¤è™•ç†å’Œå‚™ç”¨æ–¹æ¡ˆ

### å¸¸è¦‹éŒ¯èª¤å’Œå°æ‡‰ç¶²å€
```javascript
// 429 éŒ¯èª¤ï¼šThe Graph API é™æµ
// ä¸»è¦ç«¯é»: https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest
// è§£æ±ºæ–¹æ¡ˆ: ä½¿ç”¨ Apollo Client ç·©å­˜ç­–ç•¥

// 404 éŒ¯èª¤ï¼šèªè¨€æ–‡ä»¶ä¸å­˜åœ¨
// éŒ¯èª¤URL: https://www.dungeondelvers.xyz/locales/zh-TW/translation.json (ä¸å­˜åœ¨)
// æ­£ç¢ºURL: https://www.dungeondelvers.xyz/locales/zh-TW/common.json (å­˜åœ¨)

// IPFS ç¶²é—œæ•…éšœ
// ä¸»è¦ç¶²é—œ: https://ipfs.io/ipfs/
// å‚™ç”¨ç¶²é—œ: https://gateway.pinata.cloud/ipfs/
// å‚™ç”¨ç¶²é—œ: https://cloudflare-ipfs.com/ipfs/
```

## 9. ğŸ“Š ç›£æ§å’Œç®¡ç†ç«¯é»

### é–‹ç™¼ç’°å¢ƒç›£æ§
```
http://localhost:3001/health          # æœå‹™å¥åº·æª¢æŸ¥
http://localhost:3001/admin/cache/stats  # å¿«å–çµ±è¨ˆ
http://localhost:3001/admin/metrics    # æ€§èƒ½æŒ‡æ¨™
```

### ç”Ÿç”¢ç’°å¢ƒç›£æ§ (å¦‚æœéƒ¨ç½²)
```
https://api.dungeondelvers.xyz/health
https://api.dungeondelvers.xyz/admin/cache/stats
https://api.dungeondelvers.xyz/admin/metrics
```

## 10. ğŸš€ ç¸½çµ

æ‚¨çš„ Dungeon Delvers é …ç›®ä¸»è¦èª¿ç”¨ä»¥ä¸‹ç¶²å€ï¼š

1. **The Graph API**: `https://api.studio.thegraph.com/query/115633/dungeon-delvers/version/latest`
2. **Metadata Server**: `http://localhost:3001/api/`
3. **IPFS ç¶²é—œ**: `https://ipfs.io/ipfs/`ã€`https://gateway.pinata.cloud/ipfs/` ç­‰
4. **BSC RPC**: `https://bsc-dataseed1.binance.org/`
5. **ä¸»ç¶²ç«™**: `https://www.dungeondelvers.xyz/`

æ‰€æœ‰é€™äº›ç«¯é»éƒ½æ˜¯åˆ†ä½ˆå¼çš„ï¼Œç¢ºä¿äº†é«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚