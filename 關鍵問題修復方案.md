# é—œéµå•é¡Œä¿®å¾©æ–¹æ¡ˆ

## ğŸš¨ ç«‹å³éœ€è¦ä¿®å¾©çš„éŒ¯èª¤

### 1. DungeonPage.tsx - React Hooks æ¢ä»¶å¼èª¿ç”¨éŒ¯èª¤

**å•é¡Œä½ç½®**: ç¬¬234-249è¡Œ
**éŒ¯èª¤**: åœ¨æ¢ä»¶èªå¥å…§èª¿ç”¨React Hooksï¼Œé•åäº†Hooksè¦å‰‡

**ç•¶å‰å•é¡Œä»£ç¢¼**:
```typescript
// åƒ…æ”¯æ´ä¸»ç¶²
if (chainId !== bsc.id) {
    return <div className="flex justify-center items-center h-64"><p className="text-lg text-gray-500">è«‹é€£æ¥åˆ°æ”¯æ´çš„ç¶²è·¯</p></div>;
}

const dungeonMasterContract = getContract(bsc.id, 'dungeonMaster');
const { writeContractAsync, isPending: isTxPending } = useWriteContract(); // âŒ æ¢ä»¶å¼èª¿ç”¨Hook

// â˜… æ ¸å¿ƒæ”¹é€ ï¼šä½¿ç”¨æ–°çš„ Hook ç²å–éšŠä¼æ•¸æ“š
const { data: parties, isLoading: isLoadingParties } = usePlayerParties(); // âŒ æ¢ä»¶å¼èª¿ç”¨Hook

// ç²å–åœ°åŸè³‡è¨Šçš„é‚è¼¯ä¿æŒä¸è®Šï¼Œå› ç‚ºé€™æ˜¯å…¨åŸŸæ•¸æ“š
const { data: dungeonsData, isLoading: isLoadingDungeons } = useReadContracts({ // âŒ æ¢ä»¶å¼èª¿ç”¨Hook
```

**ä¿®å¾©æ–¹æ¡ˆ**:
```typescript
const DungeonPage: React.FC<{ setActivePage: (page: Page) => void; }> = ({ setActivePage }) => {
    const { chainId } = useAccount();
    const { showToast } = useAppToast();
    const { addTransaction, transactions } = useTransactionStore();

    // âœ… å°‡æ‰€æœ‰Hooksèª¿ç”¨ç§»åˆ°çµ„ä»¶é ‚éƒ¨ï¼Œåœ¨ä»»ä½•æ¢ä»¶èªå¥ä¹‹å‰
    const dungeonMasterContract = getContract(bsc.id, 'dungeonMaster');
    const { writeContractAsync, isPending: isTxPending } = useWriteContract();
    const { data: parties, isLoading: isLoadingParties } = usePlayerParties();
    const { data: dungeonsData, isLoading: isLoadingDungeons } = useReadContracts({
        contracts: Array.from({ length: 10 }, (_, i) => ({
            ...getContract(bsc.id, 'dungeonStorage'),
            functionName: 'getDungeon',
            args: [BigInt(i + 1)],
        })),
        query: { enabled: !!getContract(bsc.id, 'dungeonStorage') && chainId === bsc.id }
    });

    const [isProvisionModalOpen, setIsProvisionModalOpen] = useState(false);
    const [selectedPartyForProvision, setSelectedPartyForProvision] = useState<bigint | null>(null);

    // âœ… æ¢ä»¶æ¸²æŸ“ç§»åˆ°æ‰€æœ‰Hooksä¹‹å¾Œ
    if (chainId !== bsc.id) {
        return <div className="flex justify-center items-center h-64"><p className="text-lg text-gray-500">è«‹é€£æ¥åˆ°æ”¯æ´çš„ç¶²è·¯</p></div>;
    }

    // å…¶é¤˜é‚è¼¯ä¿æŒä¸è®Š...
```

### 2. VipPage.tsx - React Hooks æ¢ä»¶å¼èª¿ç”¨éŒ¯èª¤

**å•é¡Œä½ç½®**: ç¬¬17-28è¡Œ
**éŒ¯èª¤**: åœ¨æ¢ä»¶èªå¥å…§èª¿ç”¨React Hooks

**ç•¶å‰å•é¡Œä»£ç¢¼**:
```typescript
const VipCardDisplay: React.FC<{ tokenId: bigint | null, chainId: number | undefined }> = ({ tokenId, chainId }) => {
    if (!chainId || (chainId !== bsc.id)) {
        return <div className="w-full aspect-square bg-gray-900/50 rounded-xl flex items-center justify-center text-gray-500">ç¶²è·¯ä¸æ”¯æ´</div>;
    }
    const vipStakingContract = getContract(chainId as any, 'vipStaking');
    
    const { data: tokenURI, isLoading, isError } = useReadContract({ // âŒ æ¢ä»¶å¼èª¿ç”¨Hook
```

**ä¿®å¾©æ–¹æ¡ˆ**:
```typescript
const VipCardDisplay: React.FC<{ tokenId: bigint | null, chainId: number | undefined }> = ({ tokenId, chainId }) => {
    // âœ… å°‡Hookèª¿ç”¨ç§»åˆ°çµ„ä»¶é ‚éƒ¨
    const vipStakingContract = getContract(chainId as any, 'vipStaking');
    
    const { data: tokenURI, isLoading, isError } = useReadContract({
        ...vipStakingContract,
        functionName: 'tokenURI',
        args: [tokenId!],
        query: { 
            enabled: !!tokenId && 
                     tokenId > 0n && 
                     !!vipStakingContract && 
                     !!chainId && 
                     chainId === bsc.id 
        },
    });

    // âœ… æ¢ä»¶æ¸²æŸ“ç§»åˆ°Hookä¹‹å¾Œ
    if (!chainId || (chainId !== bsc.id)) {
        return <div className="w-full aspect-square bg-gray-900/50 rounded-xl flex items-center justify-center text-gray-500">ç¶²è·¯ä¸æ”¯æ´</div>;
    }

    // å…¶é¤˜é‚è¼¯ä¿æŒä¸è®Š...
```

### 3. NftCard.tsx - Switch Case è²æ˜éŒ¯èª¤

**å•é¡Œä½ç½®**: ç¬¬33, 41, 49, 62è¡Œ
**éŒ¯èª¤**: åœ¨switch caseä¸­ç›´æ¥è²æ˜è®Šé‡ï¼Œéœ€è¦ç”¨å¤§æ‹¬è™ŸåŒ…åœ

**ç•¶å‰å•é¡Œä»£ç¢¼**:
```typescript
switch (nft.type) {
  case 'hero':
    const hero = nft as HeroNft; // âŒ éœ€è¦å¤§æ‹¬è™Ÿ
    return (
      <>
        <StarRating rating={hero.rarity} />
        <p className="text-lg font-bold text-indigo-400">{hero.power.toString()} MP</p>
      </>
    );
  case 'relic':
    const relic = nft as RelicNft; // âŒ éœ€è¦å¤§æ‹¬è™Ÿ
```

**ä¿®å¾©æ–¹æ¡ˆ**:
```typescript
switch (nft.type) {
  case 'hero': {  // âœ… æ·»åŠ å¤§æ‹¬è™Ÿ
    const hero = nft as HeroNft;
    return (
      <>
        <StarRating rating={hero.rarity} />
        <p className="text-lg font-bold text-indigo-400">{hero.power.toString()} MP</p>
      </>
    );
  }
  case 'relic': {  // âœ… æ·»åŠ å¤§æ‹¬è™Ÿ
    const relic = nft as RelicNft;
    return (
      <>
        <StarRating rating={relic.rarity} />
        <p className="text-lg font-bold text-teal-400">å®¹é‡: {relic.capacity}</p>
      </>
    );
  }
  case 'party': {  // âœ… æ·»åŠ å¤§æ‹¬è™Ÿ
    const party = nft as PartyNft;
    return (
      <>
        <StarRating rating={party.partyRarity} />
        <div className="text-xs text-gray-400 flex justify-center items-center gap-2">
            <span>è‹±é›„: {party.heroIds.length}</span>
            <span>/</span>
            <span>è–ç‰©: {party.relicIds.length}</span>
        </div>
        <p className="text-lg font-bold mt-1 text-green-400">{party.totalPower.toString()} MP</p>
      </>
    );
  }
  case 'vip': {  // âœ… æ·»åŠ å¤§æ‹¬è™Ÿ
    const vip = nft as VipNft;
    return (
        <>
            <StarRating rating={5} /> 
            <p className="text-lg font-bold text-yellow-300">ç­‰ç´š {vip.level}</p>
        </>
    );
  }
  default:
    return null;
}
```

## ğŸ”§ åŸ·è¡Œä¿®å¾©çš„é †åº

1. **ç«‹å³ä¿®å¾©**: å…ˆä¿®å¾©ä¸Šè¿°3å€‹é—œéµçš„React Hookså’Œèªæ³•éŒ¯èª¤
2. **æ¸¬è©¦é©—è­‰**: ä¿®å¾©å¾Œé‹è¡Œ `npm run lint` ç¢ºèªéŒ¯èª¤æ¸›å°‘
3. **é€æ­¥æ¸…ç†**: å†è™•ç†å…¶ä»–anyé¡å‹å’Œæœªä½¿ç”¨è®Šé‡çš„å•é¡Œ

## ğŸ“ ä¿®å¾©å¾Œé æœŸçµæœ

ä¿®å¾©é€™3å€‹é—œéµå•é¡Œå¾Œï¼ŒéŒ¯èª¤æ•¸é‡å°‡å¾79å€‹æ¸›å°‘åˆ°ç´„65-70å€‹ï¼Œä¸»è¦å‰©é¤˜çš„å°‡æ˜¯ï¼š
- TypeScript anyé¡å‹è­¦å‘Šï¼ˆä¸å½±éŸ¿é‹è¡Œï¼‰
- æœªä½¿ç”¨è®Šé‡è­¦å‘Šï¼ˆä¸å½±éŸ¿é‹è¡Œï¼‰  
- Reactä¾è³´é …è­¦å‘Šï¼ˆä¸å½±éŸ¿é‹è¡Œï¼‰

é€™äº›ä¿®å¾©å°‡è§£æ±ºæ‰€æœ‰å¯èƒ½é˜»æ­¢é …ç›®æ­£å¸¸é‹è¡Œçš„é—œéµéŒ¯èª¤ã€‚