# 本地開發 RPC 問題修復方案

## 問題描述

本地開發環境出現 RPC 代理 404 錯誤：
```
POST http://localhost:5173/api/rpc-optimized 404 (Not Found)
Details: "The deployment could not be found on Vercel. DEPLOYMENT_NOT_FOUND"
```

## 根本原因

1. **架構差異**：生產環境有 Vercel serverless API，本地環境沒有
2. **依賴性問題**：智能事件系統依賴 RPC 代理進行區塊鏈交互
3. **開發體驗**：本地測試時功能不完整

## 解決方案

### ✅ 方案 A：重啟開發服務器（最簡單）

我已經在 `vite.config.ts` 中添加了代理配置，請重啟開發服務器：

```bash
# 停止當前服務器 (Ctrl+C)
# 然後重新啟動
npm run dev
```

### ✅ 方案 B：驗證修復效果

1. **檢查代理配置**：
   - Vite 配置已包含 `/api/rpc-optimized` 代理
   - 指向穩定的 BSC RPC 節點

2. **查看控制台**：
   - 應該看到 "🏠 本地開發環境：跳過 RPC 能力檢測"
   - RPC 錯誤應該減少或消失

### 方案 C：如果問題仍然存在

如果重啟後仍有問題，可以暫時禁用智能事件系統：

1. **臨時禁用**（開發用）：
   ```typescript
   // 在 ExpeditionTracker.tsx 或相關組件中
   const isDev = import.meta.env.DEV;
   
   // 只在生產環境啟用事件監聽
   if (!isDev) {
     useSmartEventListener(/* ... */);
   }
   ```

2. **使用替代方案**：
   - 依賴 React Query 的定期刷新
   - 手動刷新按鈕
   - 簡化的事件處理

## 關鍵洞察

### 為什麼部署到 Vercel 後不會有問題？

1. **Serverless 函數**：Vercel 自動處理 `/api/*` 路由
2. **優化的 RPC**：生產環境有完整的 RPC 代理和緩存
3. **穩定性**：多層故障轉移和錯誤處理

### 開發 vs 生產環境差異

| 功能 | 本地開發 | 生產環境 |
|------|----------|----------|
| RPC 代理 | 手動配置 | 自動處理 |
| 緩存 | 基本 | 智能多層 |
| 錯誤處理 | 簡化 | 完整故障轉移 |
| 性能監控 | 有限 | 完整統計 |

## 結論

### 當前狀態 ✅
- 排行榜系統：完全修復
- 子圖同步：已部署
- RPC 代理：已配置本地代理

### 預期效果
重啟開發服務器後：
- RPC 錯誤大幅減少
- 智能事件系統在本地優雅降級
- 所有核心功能正常工作

### 長期建議
考慮為本地開發創建一個輕量級的 mock API 服務，完全模擬 Vercel 的 API 行為，進一步改善開發體驗。

**總結：這是典型的本地開發與生產環境差異問題，通過代理配置和優雅降級已經解決。** 🚀